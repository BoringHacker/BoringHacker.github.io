<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-cn">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.0.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.4">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.4" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.0.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="DS100P,">


<meta name="description" content="update:增加几道好一点的例题吧 [NOI2004]郁闷的出纳员 [模板]文艺平衡树 [SHOI2013]发牌 [TJOI2010]中位数 [TJOI2007]书架 正文：关于SPLAY其实我更偏向于把splay叫做cosplay 讲平衡树总逃不过BST(Binary Search Tree)，二叉搜索树，以下是BST的性质： 一棵合法的BST每个节点上都带有一个数值，我们将其称为节点的“关键">
<meta name="keywords" content="DS100P">
<meta property="og:type" content="article">
<meta property="og:title" content="数据结构100题 ---splay">
<meta property="og:url" content="www.orchid-any.cf/2020/02/07/DS100P-SPLAY/index.html">
<meta property="og:site_name" content="BoringHacker&#39;s Blog">
<meta property="og:description" content="update:增加几道好一点的例题吧 [NOI2004]郁闷的出纳员 [模板]文艺平衡树 [SHOI2013]发牌 [TJOI2010]中位数 [TJOI2007]书架 正文：关于SPLAY其实我更偏向于把splay叫做cosplay 讲平衡树总逃不过BST(Binary Search Tree)，二叉搜索树，以下是BST的性质： 一棵合法的BST每个节点上都带有一个数值，我们将其称为节点的“关键">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/posts/post-8.png">
<meta property="og:updated_time" content="2020-02-20T02:48:47.132Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="数据结构100题 ---splay">
<meta name="twitter:description" content="update:增加几道好一点的例题吧 [NOI2004]郁闷的出纳员 [模板]文艺平衡树 [SHOI2013]发牌 [TJOI2010]中位数 [TJOI2007]书架 正文：关于SPLAY其实我更偏向于把splay叫做cosplay 讲平衡树总逃不过BST(Binary Search Tree)，二叉搜索树，以下是BST的性质： 一棵合法的BST每个节点上都带有一个数值，我们将其称为节点的“关键">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/posts/post-8.png">



  <link rel="alternate" href="/atom.xml" title="BoringHacker's Blog" type="application/atom+xml">




  <link rel="canonical" href="www.orchid-any.cf/2020/02/07/DS100P-SPLAY/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>数据结构100题 ---splay | BoringHacker's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-cn">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">BoringHacker's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Stay Hungry, Stay Foolish</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="www.orchid-any.cf/2020/02/07/DS100P-SPLAY/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BoringHacker">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BoringHacker's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">数据结构100题 ---splay</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-07T14:51:04+08:00">2020-02-07</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Note/" itemprop="url" rel="index"><span itemprop="name">Note</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox" href="https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/posts/post-8.png" rel="gallery_ck8wtuww0002sxgvrapcc9kqs" itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/posts/post-8.png" itemprop="contentUrl">
              </a>
            
          

          
          </div>
        </div>
      

      
        <h1 id="update"><a href="#update" class="headerlink" title="update:"></a>update:</h1><p>增加几道好一点的例题吧</p>
<p><a href="https://www.luogu.com.cn/problem/P1486" target="_blank" rel="noopener">[NOI2004]郁闷的出纳员</a></p>
<p><a href="https://www.luogu.com.cn/problem/P3391" target="_blank" rel="noopener">[模板]文艺平衡树</a></p>
<p><a href="https://www.luogu.com.cn/problem/P3988" target="_blank" rel="noopener">[SHOI2013]发牌</a></p>
<p><a href="https://www.luogu.com.cn/problem/P3871" target="_blank" rel="noopener">[TJOI2010]中位数</a></p>
<p><a href="https://www.luogu.com.cn/problem/P3850" target="_blank" rel="noopener">[TJOI2007]书架</a></p>
<h1 id="正文：关于SPLAY"><a href="#正文：关于SPLAY" class="headerlink" title="正文：关于SPLAY"></a>正文：关于SPLAY</h1><p>其实我更偏向于把splay叫做<del>cosplay</del></p>
<p>讲平衡树总逃不过BST(Binary Search Tree)，二叉搜索树，以下是BST的性质：</p>
<p>一棵合法的BST每个节点上都带有一个数值，我们将其称为节点的“关键码”。那么对于一棵BST上的任意节点，满足：</p>
<ul>
<li><p>该节点的关键码不小于它左子树的任意结点的关键码</p>
</li>
<li><p>该结点的关键码不大于它右子树的任意结点的关键码</p>
</li>
</ul>
<p><code>显然</code>，BST的中序遍历是一个递增的序列</p>
<h2 id="建立一棵BST"><a href="#建立一棵BST" class="headerlink" title="建立一棵BST"></a>建立一棵BST</h2><p>因为笔者很懒，不想到处判边界，所以我们一般可以在一棵空的BST中预先插入两个结点，一个正无穷，一个负无穷，如图:</p>
<p><img src="https://i.loli.net/2019/12/13/V2N6AQUynRGvzYI.png" alt="img spfaed"></p>
<pre><code class="lang-cpp">const int SIZE = 1e5 + 5;
const int INF = 0x7fffffff;
struct BSTNode {
    int l, r; // 左右儿子的编号
   int val; // 关键码
} T[SIZE];
int tot, root;

int clone(int val) { // 新建节点
    T[++tot].val = val;
   return tot;
}

void build() {
    clone(-INF), clone(INF);
   root = 1, T[1].r = 2;
}
</code></pre>
<p>以上是建树的代码</p>
<p>那么，BST就讲到这里</p>
<h2 id="平衡树的诞生"><a href="#平衡树的诞生" class="headerlink" title="平衡树的诞生"></a>平衡树的诞生</h2><p>当BST形成一条链的时候，每次查询会变成$O(n^2)$</p>
<p>这种深度过深的BST是不平衡的。所以我们需要一种能保持树的深度在$\log(n)$的数据结构，于是便诞生了平衡树</p>
<h2 id="SPLAY"><a href="#SPLAY" class="headerlink" title="SPLAY"></a>SPLAY</h2><p>splay，又称<del>cosplay</del>伸展树，有“序列之王”的美称，<del>常数巨大</del>，跑的没有$fhq-treap$快，但这不在我们的讨论范围以内</p>
<p><img src="https://i.loli.net/2019/12/13/jFfZRvedxLYJg2y.png" alt="graph.png"></p>
<p>想象一下这样一颗BST，我们先把它们的大小关系列出来。</p>
<script type="math/tex; mode=display">
Y<Z, C>Y, X<Y,A<X,B>X</script><p>对于这样一颗BST，我们可以通过一些特殊的方式来改变它的形态保持中序序列不变，这也是平衡树的精髓。</p>
<p>怎么改变呢？</p>
<h2 id="旋转"><a href="#旋转" class="headerlink" title="旋转"></a>旋转</h2><p>旋转<del>不转不是中国人</del>，这是splay的精髓所在。</p>
<p>现在我们的目标是让X节点往上爬到它父亲节点Y处，让Y变成X的幺儿，也就是让Y节点下降。</p>
<p><code>这个过程首先要满足BST性质</code></p>
<p>通过例图来思考，此时的X节点是Y节点的左儿子，小于Y节点，为了不改变中序序列，我们可以让Y节点成为X的右儿子。那么问题来了：变换后的Y的确大于X，但X还有一颗右子树呢！</p>
<p>别急，再回想一下BST的性质，任意节点大于其左子树中的任意节点，也就是说我们可以把X的左子树B拿给Y当左子树。</p>
<p>好了！世界核平了！<del>Tarjan放心了</del></p>
<p>展示一下旋转的成果吧！</p>
<p>旋转前：</p>
<p><img src="https://i.loli.net/2019/12/13/jFfZRvedxLYJg2y.png" alt="graph.png"></p>
<p>旋转后</p>
<p><img src="https://i.loli.net/2019/12/13/Dr5IfBWVl7b6PTH.png" alt="graph _1_.png"></p>
<p>别高兴得太早！</p>
<p>这只是一种情况，我们需要的是<code>通用</code></p>
<p>这里有一个小技巧，即：</p>
<script type="math/tex; mode=display">
odd\bigoplus1=odd-1</script><script type="math/tex; mode=display">
even\bigoplus1=even+1</script><p>这个性质的证明很简单：</p>
<p><code>即得易见平凡，仿照上例显然。</code></p>
<p><code>留作习题答案略，读者自证不难。</code></p>
<p><code>反之亦然同理，推论自然成立，略去过程QED，由上可知证毕。</code></p>
<p>$Just$ $a$ $joke$</p>
<p>设节点Y为X的父亲，Y的w(0代表左儿子，1代表右儿子)儿子</p>
<ul>
<li>$step1$:将Y节点放到X节点的w$\bigoplus$1的位置</li>
<li>$step2$:如果X的w$\bigoplus$1位置上有一颗子树，放在Y的w位置上</li>
</ul>
<pre><code class="lang-cpp">inline void update(int x) { // 更新节点信息
    T[x].siz = T[T[x].ch[0]].siz + T[T[x].ch[1]].siz + T[x].cnt;
}

inline void rotate(int x) { // 旋转
    int y = T[x].fa; // X它爹
    int z = T[y].fa; // X它爹它爹
    int w = T[y].ch[1] == x; // X是它爹的左幺儿还是右幺儿
    T[z].ch[T[z].ch[1] == y] = x;
    T[x].fa = z;
    T[y].ch[w] = T[x].ch[w ^ 1];
    T[T[x].ch[w ^ 1]].fa = y;
    T[x].ch[w ^ 1] = y;
    T[y].fa = x;
    update(y), update(x);
}
</code></pre>
<p>仅仅有rotate操作还不够，splay到目前为止依然很容易被卡。</p>
<p>想象这样一棵树：</p>
<p><img src="https://i.loli.net/2019/12/13/6hBzE2UsC8oJXfu.png" alt="img spfaed"></p>
<p>发现无论怎么旋转X都不能使得这棵树最长的一条链变短。我们称这种X，X它爹，X它爹它爹在一条线上的情况称为三点共线。</p>
<p>怎么办呢？<del>可怜的splay被人溜了</del></p>
<p>办法还是有滴</p>
<ul>
<li>$step1$:如果三点共线，我们可以先旋转X它爹，这样便可以使其更加“平衡”</li>
<li>$step2$:如果不共线……不共线……那就旋转X就好了</li>
</ul>
<p>这便是splay操作</p>
<pre><code class="lang-cpp">inline void splay(int x, int goal) { //splay
    for (; T[x].fa ^ goal; rotate(x)) { // 一直旋转到x成为goal的儿子
        int y = T[x].fa;
        int z = T[y].fa;
        if (z ^ goal)
            T[y].ch[1] ^ x ^ T[z].ch[1] ^ y ? rotate(x) : rotate(y); //判断三点是否共线，如果是，就旋转Y，否则旋转X
    }
    if (!goal) root = x; // 把根节点设为X
}
</code></pre>
<p>至此，splay就差不多讲完了，那么再来一道例题吧</p>
<p><a href="https://www.luogu.com.cn/problem/P3369" target="_blank" rel="noopener">【模板】普通平衡树</a></p>
<ul>
<li>题面：</li>
</ul>
<pre><code>您需要写一种数据结构（可参考题目标题），来维护一些数，其中需要提供以下操作：
1.插入 x 数
2.删除 x 数(若有多个相同的数，因只删除一个)
3.查询 x 数的排名(排名定义为比当前数小的数的个数 +1 )
4.查询排名为 x 的数
5.求 x 的前驱(前驱定义为小于 x，且最大的数)
6.求 x 的后继(后继定义为大于 x，且最小的数)
</code></pre><h2 id="插入操作"><a href="#插入操作" class="headerlink" title="插入操作"></a>插入操作</h2><p>首先我们先查找BST当中有没有和需要插入的节点关键码相同的节点，如果有，就把当前节点的“副本”数+1</p>
<p>如果没有，就遍历到叶子节点，再新增一个节点就好了</p>
<pre><code class="lang-cpp">inline void insert(int x) {
    int u = root, fa = 0; // 从根节点开始找
    while (u &amp;&amp; x ^ T[u].val) // 找关键码相同的节点
        fa = u, u = T[u].ch[x &gt; T[u].val];
    if (u) T[u].cnt++; // 如果有，就增加一个副本
    else { // 否则新建一个节点
        u = ++tot;
        if (fa) T[fa].ch[x &gt; T[fa].val] = u;
        T[u].fa = fa;
        T[u].siz = T[u].cnt = 1;
        T[u].ch[0] = T[u].ch[1] = 0;
        T[u].val = x;
    }
    splay(u, 0);
}
</code></pre>
<h2 id="查找操作"><a href="#查找操作" class="headerlink" title="查找操作"></a>查找操作</h2><p>设查找节点的关键码为x，如果x大于当前节点的关键码，就往右子树跑，否则往左子树找。找到后把当前节点splay到根，保证BST的平衡</p>
<pre><code class="lang-cpp">inline void find(int x) {
    int u = root;
    if (!u) return ; // BST空
    while (T[u].ch[x &gt; T[u].val] &amp;&amp; x ^ T[u].val)
        u = T[u].ch[x &gt; T[u].val];
    splay(u, 0);
}
</code></pre>
<h2 id="前驱-后继操作"><a href="#前驱-后继操作" class="headerlink" title="前驱/后继操作"></a>前驱/后继操作</h2><p>首先执行find操作。</p>
<p>以前驱为例，当前的根节点就是x的父节点，所以如果root的关键码大于x，那么root就是x的前驱。否则就跳到左儿子找，再反着跳就好了</p>
<pre><code class="lang-cpp">inline int next_bound(int x, int f) { // f=0前驱，f=1后继
    find(x);
    int u = root; // x的父节点
    if (T[u].val &gt; x &amp;&amp; f) return u;
    if (T[u].val &lt; x &amp;&amp; !f) return u;
    u = T[u].ch[f]; // 跳到对应的子树
    while (T[u].ch[f ^ 1]) u = T[u].ch[f ^ 1]; // 反着跳转
    return u;
}
</code></pre>
<h2 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h2><p>找到这个数的last，把他splay到根节点</p>
<p>然后找到这个数next，把他splay到last的底下</p>
<p>然后……然后就没有了呀……</p>
<p>比last大是next</p>
<p>比next小的且比last大的只有当前的节点</p>
<p>在next的左幺儿上面，</p>
<p>だから直接把root右幺儿的左幺儿删掉就可以了</p>
<pre><code class="lang-cpp">inline void erase(int x) {
    int last = next_bound(x, 0);
    int next = next_bound(x, 1);
    splay(last, 0), splay(next, last);
    int del = T[next].ch[0];
    if (T[del].cnt &gt; 1) {
        T[del].cnt--;
        splay(del, 0);
    }
    else T[next].ch[0] = 0;
}
</code></pre>
<h2 id="第K大"><a href="#第K大" class="headerlink" title="第K大"></a>第K大</h2><p>现在再来看已经十分简单了</p>
<p>首先如果左子树的大小加上本身的个数大于k，直接在左子树里找就行了</p>
<p>否则就把k减去左子树大小再减去本身的个数，再在右子树里找就行了</p>
<pre><code class="lang-cpp">inline int kth_element(int x) {
    int u = root;
    if (T[u].siz &lt; x) return 0; // 没有那么多，直接死亡
    while (233) {
        int y = T[u].ch[0];
        if (x &gt; T[y].siz + T[u].cnt) {
            x -= T[y].siz + T[u].cnt;
            u = T[u].ch[1];
        }
        else if (T[y].siz &gt;= x) u = y;
        else return T[u].val;
    }
}
</code></pre>
<p>完整代码：</p>
<pre><code class="lang-cpp">#include &lt;cstdio&gt;
#include &lt;iostream&gt;
#include &lt;algorithm&gt;
#include &lt;cstring&gt;
#include &lt;vector&gt;

using namespace std;

const int SIZE = 1e5 + 5;
int n, root, tot;
struct SPLAY {
    int fa;
    int siz;
    int cnt;
    int val;
    int ch[2];
} T[SIZE];

inline void update(int x) {
    T[x].siz = T[T[x].ch[0]].siz + T[T[x].ch[1]].siz + T[x].cnt;
}

inline void rotate(int x) {
    int y = T[x].fa;
    int z = T[y].fa;
    int w = T[y].ch[1] == x;
    T[z].ch[T[z].ch[1] == y] = x;
    T[x].fa = z;
    T[y].ch[w] = T[x].ch[w ^ 1];
    T[T[x].ch[w ^ 1]].fa = y;
    T[x].ch[w ^ 1] = y;
    T[y].fa = x;
    update(y), update(x);
}

inline void splay(int x, int goal) {
    for (; T[x].fa ^ goal; rotate(x)) {
        int y = T[x].fa;
        int z = T[y].fa;
        if (z ^ goal)
            T[y].ch[1] ^ x ^ T[z].ch[1] ^ y ? rotate(x) : rotate(y);
    }
    if (!goal) root = x;
}

inline void find(int x) {
    int u = root;
    if (!u) return ;
    while (T[u].ch[x &gt; T[u].val] &amp;&amp; x ^ T[u].val)
        u = T[u].ch[x &gt; T[u].val];
    splay(u, 0);
}

inline void insert(int x) {
    int u = root, fa = 0;
    while (u &amp;&amp; x ^ T[u].val)
        fa = u, u = T[u].ch[x &gt; T[u].val];
    if (u) T[u].cnt++;
    else {
        u = ++tot;
        if (fa) T[fa].ch[x &gt; T[fa].val] = u;
        T[u].fa = fa;
        T[u].siz = T[u].cnt = 1;
        T[u].ch[0] = T[u].ch[1] = 0;
        T[u].val = x;
    }
    splay(u, 0);
}

inline int next_bound(int x, int f) {
    find(x);
    int u = root;
    if (T[u].val &gt; x &amp;&amp; f) return u;
    if (T[u].val &lt; x &amp;&amp; !f) return u;
    u = T[u].ch[f];
    while (T[u].ch[f ^ 1]) u = T[u].ch[f ^ 1];
    return u;
}

inline void erase(int x) {
    int last = next_bound(x, 0);
    int next = next_bound(x, 1);
    splay(last, 0), splay(next, last);
    int del = T[next].ch[0];
    if (T[del].cnt &gt; 1) {
        T[del].cnt--;
        splay(del, 0);
    }
    else T[next].ch[0] = 0;
}

inline int kth_element(int x) {
    int u = root;
    if (T[u].siz &lt; x) return 0;
    while (233) {
        int y = T[u].ch[0];
        if (x &gt; T[y].siz + T[u].cnt) {
            x -= T[y].siz + T[u].cnt;
            u = T[u].ch[1];
        }
        else if (T[y].siz &gt;= x) u = y;
        else return T[u].val;
    }
}

signed main() {
    scanf(&quot;%d&quot;, &amp;n);
    insert(1e9);
    insert(-1e9);
    for (int i = 1; i &lt;= n; ++i) {
        int opt, x;
        scanf(&quot;%d %d&quot;, &amp;opt, &amp;x);
        if (opt == 1) insert(x);
        if (opt == 2) erase(x);
        if (opt == 3) {
            find(x);
            printf(&quot;%d\n&quot;, T[T[root].ch[0]].siz);
        }
        if (opt == 4) printf(&quot;%d\n&quot;, kth_element(x + 1));
        if (opt == 5) printf(&quot;%d\n&quot;, T[next_bound(x, 0)].val);
        if (opt == 6) printf(&quot;%d\n&quot;, T[next_bound(x, 1)].val);
    }
    return 0;
}
</code></pre>
<h1 id="欢迎捉虫子"><a href="#欢迎捉虫子" class="headerlink" title="欢迎捉虫子"></a>欢迎捉虫子</h1><p><img src="https://i.loli.net/2019/12/14/X5FNPW4wCqzgkQ9.png" alt="wd and noip.png"></p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/DS100P/" rel="tag"># DS100P</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/02/07/DS100P-SEGMENT-TREE/" rel="next" title="数据结构100题 ---线段树">
                <i class="fa fa-chevron-left"></i> 数据结构100题 ---线段树
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/02/07/DS100P-LINK-CUT-TREE/" rel="prev" title="数据结构100题 ---Link-Cut Tree">
                数据结构100题 ---Link-Cut Tree <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">BoringHacker</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">52</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#update"><span class="nav-number">1.</span> <span class="nav-text">update:</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#正文：关于SPLAY"><span class="nav-number">2.</span> <span class="nav-text">正文：关于SPLAY</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#建立一棵BST"><span class="nav-number">2.1.</span> <span class="nav-text">建立一棵BST</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#平衡树的诞生"><span class="nav-number">2.2.</span> <span class="nav-text">平衡树的诞生</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SPLAY"><span class="nav-number">2.3.</span> <span class="nav-text">SPLAY</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#旋转"><span class="nav-number">2.4.</span> <span class="nav-text">旋转</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插入操作"><span class="nav-number">2.5.</span> <span class="nav-text">插入操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查找操作"><span class="nav-number">2.6.</span> <span class="nav-text">查找操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#前驱-后继操作"><span class="nav-number">2.7.</span> <span class="nav-text">前驱/后继操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除操作"><span class="nav-number">2.8.</span> <span class="nav-text">删除操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第K大"><span class="nav-number">2.9.</span> <span class="nav-text">第K大</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#欢迎捉虫子"><span class="nav-number">3.</span> <span class="nav-text">欢迎捉虫子</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BoringHacker</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Pisces</a> v6.0.4</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.0.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.4"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
