<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">?????100?? 21~30?? | BoringHacker&#39;s Blog</title>
  
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/favicon.png">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
    <style>
  .emoji-coda {
      display: inline-block !important;
      position: relative;
      width: 45px;
      top: 2px;
      margin: -3px 3px !important;
      padding: 0;
  }
  </style>

  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "BoringHacker'sBlog";
  mashiro_option.author_name = "Blog";
  mashiro_option.site_url = "https://www.orchid-any.cf/";
  mashiro_option.v_appId = "8Hho6gvnedMT9NMEhnEx3UOg-gzGzoHsz";
  mashiro_option.v_appKey = "gU70zYoblzxCmc6iL697pp69";
  mashiro_option.mathjax = "1";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/index1.png,https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/index2.png,https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/index3.png,https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/index4.png,https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/index5.png,https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/index6.png,https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/index7.png,https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/index8.png".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
</head>
</html>
<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
    <style type="text/css">
    @import url("/code.css");
  </style>
   <div class="skin-menu no-select" id="mainskin" style="position: fixed;bottom:65px;left:31px;">
    <div class="theme-controls row-container">
          <p style="text-align:center;font-family:'Monaco';font-weight:bold;color:#444"><i style="color:grey" class="fa fa-chevron-left"></i> background <i style="color:grey" class="fa fa-chevron-right"></i></p>
        <ul class="menu-list"> <li id="white-bg"> 
            <i class="fa fa-television" aria-hidden="true">
            </i>
            </li> 
            <li id="sakura-bg"> 
                <i class="iconfont icon-sakura">
                </i>
            </li>
            <li id="gribs-bg">
                <i class="fa fa-slack" aria-hidden="true">
                </i>
            </li>
            <li id="KAdots-bg">
                <i class="iconfont icon-dots">
                </i>
            </li>
            <li id="totem-bg">
                <i class="fa fa-optin-monster" aria-hidden="true">
                </i>
            </li>
            <li id="pixiv-bg">
                <i class="iconfont icon-pixiv">
                </i>
            </li>
            <li id="bing-bg">
                <i class="iconfont icon-bing">
                </i>
            </li>
            <li id="dark-bg">
                <i class="fa fa-moon-o" aria-hidden="true">
                </i>
            </li>
        </ul>
    </div>
      <hr>
  <p style="text-align:center;font-family:'Monaco';font-weight:bold;color:#444"><i style="color:grey" class="fa fa-chevron-left"></i> font <i style="color:grey" class="fa fa-chevron-right"></i></p>
  <div class="font-family-controls row-container">
    <button type="button" class="control-btn-serif " data-mode="serif" onclick="mashiro_global.font_control.change_font()">Serif</button>
    <button type="button" class="control-btn-sans-serif" data-mode="sans-serif" onclick="mashiro_global.font_control.change_font()">Sans Serif</button>
  </div>
  <hr>
  <p style="text-align:center;font-family:'Monaco';font-weight:bold;color:#444"><i style="color:grey" class="fa fa-chevron-left"></i> script <i style="color:grey" class="fa fa-chevron-right"></i></p>
  <div class="theme-controls row-container">
  <ul class="menu-list">
    <li id="empty-effect">
      <i class="fa fa-ban">
      </i>
    </li>
    <li id="sakura-rain-effect">
      <i class="iconfont icon-sakura">
      </i>
    </li>
    <li id="snowy-effect">
      <i class="fa fa-snowflake-o">
      </i>
    </li>
    <li id="lines-effect">
      <i class="fa fa-chevron-left">
      </i>
    </li>
    <li id="colorful-belts-effect">
      <i class="fa fa-map"></i>
      </i>
    </li>
    <li id="words-rain-effect">
      <i class="fa fa-font"></i>
    </li>
    <li id="point-rain-effect">
      <i class="iconfont icon-dots"></i>
    </li>
    <li id="rain-drop-effect">
      <i class="fa fa-tint"></i>
    </li>
  </ul>
  </div>

    <canvas id="night-mode-cover">
    </canvas>
</div>
 
 <div class="changeSkin-gear no-select" style="background: rgba(0, 0, 0, 0) none repeat scroll 0% 0%; visibility: visible; bottom: 0px;"> 
  <div class="keys" id="setbtn"> 
    <button id="open-skinMenu">
        <style>
        button#open-skinMenu{
            transition: all 0.2s linear 0s;
            outline:none;
            position:fixed;
            bottom:13px;
            left:15px;
            font-size:16px;
            background-color: rgba(255,255,255,.95);
            border-radius: 20px;
            box-shadow: 0 3px 8px 0 rgba(0,0,0,0.1), 0 3px 8px 0 rgba(0,0,0,0.1);
        }
        button#open-skinMenu:hover{
            transition: all 0.2s linear 0s;
            background-color: rgb(255, 165, 0);
            color: rgba(255,255,255);
        }
        </style>
        <i class="iconfont icon-gear inline-block rotating">
      </i> 
        SCHEME TOOL | 主题工具 
    </button>
  </div> 
</div>


  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop ">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://www.orchid-any.cf/">
          <img src="https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/avatar.png">
        </a>
      </div>
      <div class="header-info">
        <p>Stay Hungry, Stay Foolish</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="http://github.com/boringhacker" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://music.163.com/#/user/home?id=1842865470" target="_blank" class="social-github" title="NetEase">
                    <img src="https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/music.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://www.zhihu.com/people/boringhacker" target="_blank" class="social-github" title="zhihu">
                    <img src="https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/zhihu.png">
                  </a>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <!-- <div id="video-btn" class="loadvideo videolive">
    </div> -->
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <!-- <span class="sakurasono">BoringHacker&#39;s</span>
            <span class="shironeko">Blog</span> -->
            <img src = https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/icons/borhac.png>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    Home
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    Archives
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/bangumi/">
                          <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                          Animes
                        </a>
                      </li>
                    
                      <li>
                        <a href="/Tools/">
                          <i class="fa fa-cogs" aria-hidden="true"></i>
                          Tools
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/Note/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          Notes
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/Solution">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          Solution
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/tags/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-tags" aria-hidden="true"></i>
                    Tags
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    Comments
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    Links
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/game/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-gamepad" aria-hidden="true"></i>
                    Game
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    About
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          Me
                        </a>
                      </li>
                    
                      <li>
                        <a href="/lab/">
                          <i class="fa fa-bath" aria-hidden="true"></i>
                          Blog
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/atom.xml">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
                    RSS
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>
<script>
var spoiler=document.getElementsByClassName('spoiler');
for(var i=0;i<spoiler.length;++i)
spoiler[i].onclick=function(){this.classList.toggle("revealed");};
</script>

  <div class="pattern-center-sakura single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/posts/post-33.png);" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/posts/post-33.png">
    </div>
    <header class="pattern-header single-header" style="text-shadow: 0 0 7px #000,0 0 7px #000">

      <h1 class="entry-title">
      ?????100?? 21~30??</h1>
      <p class="entry-census">
        <span>
          <a href="/">
            <img src="https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/icons/avatar.png">
          </a>
        </span>
        <span>
          <a href="/">BoringHacker</a>
        </span>
        <span class="bull">
        ·</span>
        2020-2-8<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
      
        
          <div>
            <ul class="spfk-ul">
              &nbsp<i class="fa fa-tag" aria-hidden="true"></i>&nbsp&nbsp&nbsp&nbsp
              <li class="spfk-li"><a href="/tags/DS100P/" class="butterfly-tags">DS100P</a></li>
            </ul>
          </div>
          <script>
              function colorInit(c,num){for(var i=1;i<=num;++i)c.push(i+'');}
              function paintTags(){
                  var colorNumber=8,tagColors=[],tags=document.getElementsByClassName('butterfly-tags');
                  for(var i = 0 ; i < tags.length ; ++i){
                      if(!tagColors.length)colorInit(tagColors,colorNumber);
                      var j=Math.floor(Math.random()*tagColors.length);
                      tags[i].classList.add("spfk-color"+tagColors[j]);
                      tagColors.splice(j,1);
                  }
              }
              paintTags()
          </script>
        
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <h1 id="21-P4172-WC2006"><a href="#21-P4172-WC2006" class="headerlink" title="21.P4172 [WC2006]?????"></a>21.P4172 [WC2006]?????</h1><p>SC ? MY ???????????????????????????? MY ???????????????????????????????????????????????????????????????????????? $x$ ?????? $y$ ?????????????????????????? $A$ ?? $B$ ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????</p>
<p>??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????? MY ?????????????????????????????????2??????????????????????????</p>
<p>?????? MY ???????????I??????????????????????????????????????????????????????????????</p>
<hr>
<p>?????????????????????????????????????????????????????????</p>
<p>????????????????????????????????????????????????????????????????MST, ?????????????????MST????????????<del>????????????????????????</del>???????????LCT?????????MST??Splay????????????(???????????????)</p>
<p>??????????????????????????????????????????MST??????????????????????????MST?????????????????????????????????????????????????????????????????????????????????????????????????????</p>
<p>??????????????lct??split????????<code>??</code>????????????????????????????????????????????????????<code>??</code>????????</p>
<p>?????????????????????????????????</p>
<p>???????????????????????????</p>
<p>??????????????????????</p>
<p>????<code>????</code>?????????<code>????</code>????????</p>
<p>(<del>????????</del>)</p>
<pre><code class="lang-cpp">#include &lt;cstdio&gt;
#include &lt;iostream&gt;
#include &lt;algorithm&gt;
#include &lt;cstring&gt;
#include &lt;queue&gt;
#include &lt;stack&gt;
#define mid ((l + r) &gt;&gt; 1)
#define mp make_pair
#define fir first
#define sec second
#define pub push_back
#define pob pop_back

using namespace std;
typedef long long LL;

#define io_e &#39;\0&#39;
#define io_s &#39; &#39;
#define io_l &#39;\n&#39;
 #define _DEBUG_ 1 // debug toggle
namespace Fast_IO {
#ifndef _DEBUG_
    #define gc() (iS == iT ? (iT = (iS = ibuff) + fread(ibuff, 1, SIZ, stdin), (iS == iT ? EOF : *iS++)) : *iS++)
#else
    #define gc() getchar()
#endif
    const int SIZ = 1 &lt;&lt; 21 | 1;
    char *iS, *iT, ibuff[SIZ], obuff[SIZ], *oS = obuff, *oT = oS + SIZ - 1, fu[110], c;
    int fr;
    inline void ioout() {
        fwrite(obuff, 1, oS - obuff, stdout);
        oS = obuff;
    }
    template &lt;class Type&gt;
    inline void read(Type&amp; x) {
        x = 0;
        Type y = 1;
        for (c = gc(); (c &gt; &#39;9&#39; || c &lt; &#39;0&#39;) &amp;&amp; c ^ &#39;-&#39;; c = gc())
            ;
        c == &#39;-&#39; ? y = -1 : x = (c &amp; 15);
        for (c = gc(); c &gt;= &#39;0&#39; &amp;&amp; c &lt;= &#39;9&#39;; c = gc()) x = x * 10 + (c &amp; 15);
        x *= y;
    }
    inline bool blank(char ch) { return ch == &#39; &#39; || ch == &#39;\n&#39; || ch == &#39;\r&#39; || ch == &#39;\t&#39;; }
    inline void read(char* s) {
        register char ch = gc();
        for (; blank(ch); ch = gc())
            ;
        for (; !blank(ch); ch = gc()) *s++ = ch;
        *s = 0;
    }
    inline void read(char&amp; c) {
        for (c = gc(); blank(c); c = gc())
            ;
    }
    template &lt;typename Type, typename... Args&gt;
    inline void read(Type&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char* t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;class Type&gt;
    inline void write(char lastChar, Type x) {
        if (x &lt; 0)
            *oS++ = &#39;-&#39;, x = -x;
        if (x == 0)
            *oS++ = &#39;0&#39;;
        while (x) fu[++fr] = x % 10 + &#39;0&#39;, x /= 10;
        while (fr) *oS++ = fu[fr--];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x[]) {
        for (register int i = 0; x[i]; ++i) *oS++ = x[i];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x) {
        *oS++ = x;
        *oS++ = lastChar;
        ioout();
    }
    template &lt;typename Type, typename... Args&gt;
    inline void write(char midChar, Type t, Args... args) {
        write(midChar, t), write(midChar, args...);
    }
}  // namespace Fast_IO

using Fast_IO::read;
using Fast_IO::write;

namespace LinkCutTree {
    const int SIZE = 12e4 + 5;
    struct SPLAY {
        int ch[2];
        int fa;
        int key;
        int maxValue;
        int lazyTag;
    } T[SIZE];
    stack &lt; int &gt; MemoryWaste; 
    #define ls T[x].ch[0]
    #define rs T[x].ch[1]
    #define WhichSon(x) (T[T[x].fa].ch[1] == x)
    #define IsRoot(x) (T[T[x].fa].ch[0] ^ x &amp;&amp; T[T[x].fa].ch[1] ^ x)

    void UpdateMessage(int x) {
        T[x].maxValue = max(max(T[ls].maxValue, T[x].key), T[rs].maxValue);
    }

    void UpdateSons(int x) {
        if (T[x].lazyTag) {
            ls ^= rs ^= ls ^= rs;
            T[x].lazyTag = 0;
            T[ls].lazyTag ^= 1;
            T[rs].lazyTag ^= 1;
        }
    }

    void RotateNode(int x) {
        int y = T[x].fa;
        if (!IsRoot(y)) T[T[y].fa].ch[WhichSon(y)] = x;
        bool k = WhichSon(x);
        T[x].fa = T[y].fa;
        T[y].fa = x;
        T[y].ch[k] = T[x].ch[k ^ 1];
        T[T[y].ch[k]].fa = y;
        T[x].ch[k ^ 1] = y;
        UpdateMessage(y);
        UpdateMessage(x);
    }

    void LinkSplay(int x) {
        int u = x;
        while (!IsRoot(u)) MemoryWaste.push(u), u = T[u].fa;
        MemoryWaste.push(u);
        while (MemoryWaste.size()) UpdateSons(MemoryWaste.top()), MemoryWaste.pop();
        for (; !IsRoot(x); RotateNode(x)) {
            int y = T[x].fa;
            if (!IsRoot(y))
                RotateNode(WhichSon(x) ^ WhichSon(y) ? x : y);
        }
    }
    void AccessEdge(int x) {
        for (int u = x, y = 0; u; y = u, u = T[u].fa) {
            LinkSplay(u);
            T[u].ch[1] = y;
            UpdateMessage(u);
        }
    }

    void MakeRoot(int x) {
        AccessEdge(x);
        LinkSplay(x);
        T[x].lazyTag ^= 1;
    }

    void SplitTree(int x, int y) {
        MakeRoot(x);
        AccessEdge(y);
        LinkSplay(y);
    }

    void LinkTree(int x, int y) {
        MakeRoot(x);
        T[x].fa = y;
    }

    void CutTree(int x, int y) {
        MakeRoot(x);
        AccessEdge(y);
        LinkSplay(y);
        T[x].fa = T[y].ch[0] = 0;
    }

    int FindByKey(int x, int u) {
        if (T[x].key == u) return x;
        else if (T[ls].maxValue == u) return FindByKey(ls, u);
        else return FindByKey(rs, u);
    }
} // namespace LinkCutTree

using namespace LinkCutTree;

int F[1005][1005], U[101000], V[101000];
int OP[101000], ans[101000], n, m, QueryNumber;
struct EdgeNode {
    int x, y;
    int val, key;
    EdgeNode() { key = 1; }
    friend bool operator &lt; (EdgeNode X, EdgeNode Y) {
        return X.val &lt; Y.val;
    }
} e[101000];
struct UnionFindSet {
    int fa[1010];

    int find(int x) {
        if (x ^ fa[x]) fa[x] = find(fa[x]);
        return fa[x];
    }

    void merge(int x, int y) {
        int u = find(x), v = find(y);
        if (u ^ v) fa[u] = v;
    }

    void init(int n, int m) {
        for (int i = 1; i &lt;= n; ++i)
            fa[i] = i;
        for (int i = 1; i &lt;= m; ++i) {
            if (e[i].key &amp;&amp; find(e[i].x) ^ find(e[i].y)) {
                merge(e[i].x, e[i].y);
                LinkTree(e[i].x, n + i);
                LinkTree(e[i].y, n + i);
            }
        }
    }
} ufs;

signed main() {
    read(n, m, QueryNumber);
    for (int i = 1; i &lt;= m; ++i)
        read(e[i].x, e[i].y, e[i].val);
    sort(e + 1, e + 1 + m);
    for (int i = 1; i &lt;= m; ++i) {
        F[e[i].x][e[i].y] = i;
        F[e[i].y][e[i].x] = i;
        T[n + i].key = e[i].val;
    }
    for (int i = 1; i &lt;= QueryNumber; ++i) {
        read(OP[i], U[i], V[i]);
        if (OP[i] == 2) e[F[U[i]][V[i]]].key = 0;
    }
    ufs.init(n, m);
    int EdgeCount = 0;
    for (int i = QueryNumber; i &gt;= 1; --i) {
        SplitTree(U[i], V[i]);
        if (OP[i] == 1) ans[++EdgeCount] = T[V[i]].maxValue;
        else {
            int Temporary = FindByKey(V[i], T[V[i]].maxValue);
            if (T[F[U[i]][V[i]] + n].key &lt; T[V[i]].maxValue) {
                CutTree(e[Temporary - n].x, Temporary);
                CutTree(e[Temporary - n].y, Temporary);
                LinkTree(U[i], F[U[i]][V[i]] + n);
                LinkTree(V[i], F[U[i]][V[i]] + n);
            }    
        }
    }
    for (int i = EdgeCount; i &gt;= 1; --i)
        write(io_l, ans[i]);
    return 0;
}
</code></pre>
<h1 id="22-P3302-SDOI2013"><a href="#22-P3302-SDOI2013" class="headerlink" title="22.P3302 [SDOI2013]???"></a>22.P3302 [SDOI2013]???</h1><p>??Z????????????N??????????????????????????????????????????????????M?????</p>
<p>??Z??????T??????????????????</p>
<ol>
<li><code>Q x y k</code>?????x????y????????????????????k??????????????????????x???y??????????????????????????????k????</li>
<li><code>L x y</code>???x???y???????????????????????????????????????</li>
</ol>
<p>???????????????????????????????????????????lastans?????????????????????????????lastans?0??</p>
<ul>
<li>????????????????<code>Q x y k</code>,??????????<code>Q x^lastans y^lastans k^lastans</code>??</li>
<li>????????????????<code>L x y</code>????????????<code>L x^lastans y^lastans</code>??????^??????????????????pascal????xor????????</li>
</ul>
<p>???????????????????Z??????????????</p>
<hr>
<p>??????????????????????????????????????????????????????lct??????????<del>?????+LCT??</del>(????????????????)</p>
<p>??????????</p>
<p>???????????????????????????????????????????????????</p>
<p>?????????????????????????????????????????????????????????????????????????????????????????</p>
<pre><code class="lang-cpp">#pragma GCC diagnostic error &quot;-std=c++11&quot;
#include &lt;cstdio&gt;
#include &lt;iostream&gt;
#include &lt;algorithm&gt;
#include &lt;cstring&gt;
#include &lt;queue&gt;
#define _size_ (tr[tr[x].l].size + tr[tr[y].l].size - tr[tr[lca].l].size - tr[tr[fa_lca].l].size)
#define pii pair &lt; int , int &gt;
#define pll pair &lt; LL, LL &gt;
#define mid ((l + r) &gt;&gt; 1)
#define mp make_pair
#define fir first
#define sec second
#define pub push_back
#define pob pop_back

using namespace std;
typedef long long LL;

#define io_e &#39;\0&#39;
#define io_s &#39; &#39;
#define io_l &#39;\n&#39;
#define _DEBUG_ 1 // debug toggle
namespace Fast_IO {
    #ifndef _DEBUG_
        #define gc() (iS == iT ? (iT = (iS = ibuff) + fread(ibuff, 1, SIZ, stdin), (iS == iT ? EOF : *iS++)) : *iS++)
    #else
        #define gc() getchar()
    #endif
    const int SIZ = 1 &lt;&lt; 21 | 1;
    char *iS, *iT, ibuff[SIZ], obuff[SIZ], *oS = obuff, *oT = oS + SIZ - 1, fu[110], c;
    int fr;
    inline void ioout() {
        fwrite(obuff, 1, oS - obuff, stdout);
        oS = obuff;
    }
    template &lt;class Type&gt;
    inline void read(Type&amp; x) {
        x = 0;
        Type y = 1;
        for (c = gc(); (c &gt; &#39;9&#39; || c &lt; &#39;0&#39;) &amp;&amp; c ^ &#39;-&#39;; c = gc())
            ;
        c == &#39;-&#39; ? y = -1 : x = (c &amp; 15);
        for (c = gc(); c &gt;= &#39;0&#39; &amp;&amp; c &lt;= &#39;9&#39;; c = gc()) x = x * 10 + (c &amp; 15);
        x *= y;
    }
    inline bool blank(char ch) { return ch == &#39; &#39; || ch == &#39;\n&#39; || ch == &#39;\r&#39; || ch == &#39;\t&#39;; }
    inline void read(char* s) {
        register char ch = gc();
        for (; blank(ch); ch = gc())
            ;
        for (; !blank(ch); ch = gc()) *s++ = ch;
        *s = 0;
    }
    inline void read(char&amp; c) {
        for (c = gc(); blank(c); c = gc())
            ;
    }
    template &lt;typename Type, typename... Args&gt;
    inline void read(Type&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char* t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;class Type&gt;
    inline void write(char lastChar, Type x) {
        if (x &lt; 0)
            *oS++ = &#39;-&#39;, x = -x;
        if (x == 0)
            *oS++ = &#39;0&#39;;
        while (x) fu[++fr] = x % 10 + &#39;0&#39;, x /= 10;
        while (fr) *oS++ = fu[fr--];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x[]) {
        for (register int i = 0; x[i]; ++i) *oS++ = x[i];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x) {
        *oS++ = x;
        *oS++ = lastChar;
        ioout();
    }
    template &lt;typename Type, typename... Args&gt;
    inline void write(char midChar, Type t, Args... args) {
        write(midChar, t), write(midChar, args...);
    }
}  // namespace Fast_IO

using Fast_IO::read;
using Fast_IO::write;

const int SIZE = 9e4 + 5;
const int LSIZE = SIZE &lt;&lt; 7;
const int GSIZE = SIZE &lt;&lt; 1;
int n, m, q, waste;
int tot, rt[LSIZE], b[SIZE];
int pri_n, edge_tot, a[SIZE];
int Head[GSIZE], Next[GSIZE];
int Vertex[GSIZE], Weight[GSIZE];
int f[SIZE][LSIZE / SIZE &gt;&gt; 2];
int dp[SIZE], fa[SIZE], id[SIZE];
int size[SIZE], vis[SIZE];
struct TreeNode {
    int l, r;
    int size;
} tr[LSIZE];

void add(int x, int y, int z = 1) {
    Vertex[++edge_tot] = y, Weight[edge_tot] = z;
    Next[edge_tot] = Head[x], Head[x] = edge_tot;
}

int find_set(int x) {
    return x == fa[x] ? x : fa[x] = find_set(fa[x]);
}

int make(int l, int r) {
    int u = ++tot;
    if (l ^ r) return tr[u].l = make(l, mid), tr[u].r = make(mid + 1, r), u;
    else return 0;
}

void modify(int &amp;u, int pre, int l, int r, int x) {
    u = ++tot;
    tr[u] = TreeNode{tr[pre].l, tr[pre].r, tr[pre].size + 1};
    if (l ^ r)
        if (mid &gt;= x) modify(tr[u].l, tr[pre].l, l, mid, x);
        else modify(tr[u].r, tr[pre].r, mid + 1, r, x);
    else return ;
}

int query(int x, int y, int lca, int fa_lca, int l, int r, int k) {
    if (l ^ r)
        if (_size_ &gt;= k) return query(tr[x].l, tr[y].l, tr[lca].l, tr[fa_lca].l, l, mid, k);
        else return query(tr[x].r, tr[y].r, tr[lca].r, tr[fa_lca].r, mid + 1, r, k - _size_);
    else return l;
}

void dfs(int x, int _rt_) {
    for (int i = 1; i &lt; 17; ++i) f[x][i] = f[f[x][i - 1]][i - 1];
    modify(rt[x], rt[f[x][0]], 1, pri_n, id[x]);
#define y Vertex[i]
    for (int i = Head[x]; i; i = Next[i]) if (y ^ fa[x]) f[y][0] = x, fa[y] = x, dp[y] = dp[x] + 1, vis[x] = true, size[_rt_]++, dfs(y, _rt_);
#undef y
}

int get_lca(int x, int y) {
    if (dp[x] &lt; dp[y]) x ^= y ^= x ^= y;
    for (int i = 16; i &gt;= 0; --i) if (f[x][i] &amp;&amp; dp[f[x][i]] &gt;= dp[y]) x = f[x][i];
    if (x == y) return x;
    for (int i = 16; i &gt;= 0; --i) if (f[x][i] ^ f[y][i]) x = f[x][i], y = f[y][i];
    return f[x][0];
}

signed main() {
    read(waste, n, m, q);
    for (int i = 1; i &lt;= n; ++i) read(a[i]), b[i] = a[i];
    sort(b + 1, b + 1 + n);
    pri_n = unique(b + 1, b + 1 + n) - b - 1;
    for (int i = 1; i &lt;= n; ++i) id[i] = lower_bound(b + 1, b + 1 + pri_n, a[i]) - b;
    for (int i = 1, x, y; i &lt;= m; ++i) read(x, y), add(x, y, 1), add(y, x, 1);
    *rt = make(1, pri_n);
    for (int i = 1; i &lt;= n; ++i) if (!vis[i]) dfs(i, i), fa[i] = i;
    int ans = 0, lastans = 0;
    for (int enum_q = 0; enum_q &lt; q; ++enum_q) {
        char opt[5];
        int x, y, k, lca;
        read(opt), read(x, y);
        x ^= lastans, y ^= lastans;
        if (*opt == &#39;Q&#39;) read(k), k ^= lastans, lca = get_lca(x, y), write(io_l, lastans = ans = b[query(rt[x], rt[y], rt[lca], rt[f[lca][0]], 1, pri_n, k)]);
        else {
            add(x, y, 1);
            add(y, x, 1);
            int u = find_set(x);
            int v = find_set(y);
            if (size[u] &lt; size[v]) x ^= y ^= x ^= y, u ^= v ^= u ^= v;
            f[y][0] = x;
            fa[y] = x;
            dp[y] = dp[x] + 1;
            vis[y] = true;
            size[u]++;
            dfs(y, v);
        }
    }
    return 0;
}
</code></pre>
<h1 id="23-P3250-HNOI2016"><a href="#23-P3250-HNOI2016" class="headerlink" title="23.P3250 [HNOI2016]????"></a>23.P3250 [HNOI2016]????</h1><p>????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????</p>
<p>?????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????</p>
<ol>
<li><p>????????????????????????????????????????</p>
</li>
<li><p>????????????????????</p>
</li>
<li><p>????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????</p>
</li>
</ol>
<p>???????????????????????????????????????????????????????????????????????????????????????????????????????????????????</p>
<hr>
<p>?? $\Theta(n\log^3n)$ ????????????</p>
<p>????????????????+????????????Splay????????????T????fhq-treap?????</p>
<p>????????????????????????????????????????????????????????????</p>
<p>???????????????????????????????????????????????????????????????????????????????????????</p>
<p>??????????O2????????????2.x s ????? xxx ms!</p>
<pre><code class="lang-cpp">#pragma GCC diagnostic error &quot;-std=c++11&quot;
#include &lt;cstdio&gt;
#include &lt;iostream&gt;
#include &lt;algorithm&gt;
#include &lt;cstring&gt;
#include &lt;queue&gt;
#define CheckSize ((d[top[x]] &lt; d[top[y]]) &amp;&amp; (x ^= y ^= x ^= y))
#define ForGraph int i = Head[x], y = Vertex[i]; i; i = Next[i], y = Vertex[i]
#define pii pair &lt; int , int &gt;
#define pll pair &lt; LL, LL &gt;
#define mid ((l + r) &gt;&gt; 1)
#define mp make_pair
#define fir first
#define sec second
#define pub push_back
#define pob pop_back

using namespace std;
typedef long long LL;

#define io_e &#39;\0&#39;
#define io_s &#39; &#39;
#define io_l &#39;\n&#39;
// #define _DEBUG_ 1 // debug toggle
namespace Fast_IO {
    #ifndef _DEBUG_
        #define gc() (iS == iT ? (iT = (iS = ibuff) + fread(ibuff, 1, SIZ, stdin), (iS == iT ? EOF : *iS++)) : *iS++)
    #else
        #define gc() getchar()
    #endif
    const int SIZ = 1 &lt;&lt; 21 | 1;
    char *iS, *iT, ibuff[SIZ], obuff[SIZ], *oS = obuff, *oT = oS + SIZ - 1, fu[110], c;
    int fr;
    inline void ioout() {
        fwrite(obuff, 1, oS - obuff, stdout);
        oS = obuff;
    }
    template &lt;class Type&gt;
    inline void read(Type&amp; x) {
        x = 0;
        Type y = 1;
        for (c = gc(); (c &gt; &#39;9&#39; || c &lt; &#39;0&#39;) &amp;&amp; c ^ &#39;-&#39;; c = gc())
            ;
        c == &#39;-&#39; ? y = -1 : x = (c &amp; 15);
        for (c = gc(); c &gt;= &#39;0&#39; &amp;&amp; c &lt;= &#39;9&#39;; c = gc()) x = x * 10 + (c &amp; 15);
        x *= y;
    }
    inline bool blank(char ch) { return ch == &#39; &#39; || ch == &#39;\n&#39; || ch == &#39;\r&#39; || ch == &#39;\t&#39;; }
    inline void read(char* s) {
        register char ch = gc();
        for (; blank(ch); ch = gc())
            ;
        for (; !blank(ch); ch = gc()) *s++ = ch;
        *s = 0;
    }
    inline void read(char&amp; c) {
        for (c = gc(); blank(c); c = gc())
            ;
    }
    template &lt;typename Type, typename... Args&gt;
    inline void read(Type&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char* t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;class Type&gt;
    inline void write(char lastChar, Type x) {
        if (x &lt; 0)
            *oS++ = &#39;-&#39;, x = -x;
        if (x == 0)
            *oS++ = &#39;0&#39;;
        while (x) fu[++fr] = x % 10 + &#39;0&#39;, x /= 10;
        while (fr) *oS++ = fu[fr--];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x[]) {
        for (register int i = 0; x[i]; ++i) *oS++ = x[i];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x) {
        *oS++ = x;
        *oS++ = lastChar;
        ioout();
    }
    template &lt;typename Type, typename... Args&gt;
    inline void write(char midChar, Type t, Args... args) {
        write(midChar, t), write(midChar, args...);
    }
}  // namespace Fast_IO

using Fast_IO::read;
using Fast_IO::write;

namespace HNOI2016_Network {
    namespace IamJustForPlaying {
    namespace IamJustForPlaying {
    namespace IamJustForPlaying {
    namespace IamJustForPlaying {
    namespace IamJustForPlaying {
    namespace IamJustForPlaying {
    namespace IamJustForPlaying {
    const int SIZE = 2e5 + 5;
    const int GSIZE = SIZE &lt;&lt; 1;

    namespace SegmentTree {
        priority_queue &lt; int &gt; I[SIZE&lt;&lt;1], D[SIZE&lt;&lt;1];
        #define ls (k &lt;&lt; 1)
        #define rs (k &lt;&lt; 1 | 1)

        void DoModify(int k, int l, int r, int x, int y, int val, int opt) {
            if (!(l &gt; y || r &lt; x))
                if (l &gt;= x &amp;&amp; r &lt;= y)
                    if (opt) I[k].push(val);
                    else D[k].push(val);
                else DoModify(ls, l, mid, x, y, val, opt), DoModify(rs, mid + 1, r, x, y, val, opt);
        }

        int GetAnswer(int k, int l, int r, int x) {
            while (I[k].size() &amp;&amp; D[k].size() &amp;&amp; I[k].top() == D[k].top()) I[k].pop(), D[k].pop();
            int res = I[k].size() ? I[k].top() : -1;
            if (l ^ r)
                if (mid &gt;= x) res = max(res, GetAnswer(ls, l, mid, x));
                else res = max(res, GetAnswer(rs, mid + 1, r, x));
            return res;
        }
    } // namespace SegmentTree

    namespace TreeChainSplitting {
        int tx[SIZE], ty[SIZE], tk[SIZE];
        int Head[SIZE], Vertex[GSIZE];
        int Next[GSIZE], EdgeCount;
        int fa[SIZE], size[SIZE];
        int d[SIZE], son[SIZE];
        int dfn[SIZE], rnk[SIZE];
        int top[SIZE], tot;
        int edge_tot = 0, n, m;
        struct Vector2 {
            int x; int y;

            friend bool operator &lt; (Vector2 rhs1, Vector2 rhs2) { return rhs1.x &lt; rhs2.x; }
        } Vec2[SIZE];

        void add(int x, int y) {
            Vertex[++edge_tot] = y;
            Next[edge_tot] = Head[x];
            Head[x] = edge_tot;
        }

        void dfs1(int x, int fa) {
            size[x] = 1, TreeChainSplitting::fa[x] = fa, d[x] = d[fa] + 1;
            for (ForGraph) if (y ^ fa) dfs1(y, x), size[x] += size[y], ((size[son[x]] &lt; size[y]) &amp;&amp; (son[x] = y));
        }

        void dfs2(int x, int tp) {
            top[x] = tp, dfn[x] = ++tot, rnk[tot] = x;
            if (son[x]) dfs2(son[x], tp);
            for (ForGraph) if (y ^ fa[x] &amp;&amp; y ^ son[x]) dfs2(y, y);
        }

        void ModifySubTree(int x, int y, int val, int opt, int tp = 0) {
            while (top[x] ^ top[y]) CheckSize, Vec2[++tp] = {dfn[top[x]], dfn[x]}, x = fa[top[x]];
            if (dfn[x] &gt; dfn[y]) x ^= y ^= x ^= y;
            Vec2[++tp] = {dfn[x], dfn[y]};
            sort(Vec2 + 1, Vec2 + 1 + tp);
            int Sys = 1;
            for (int i = 1; i &lt;= tp; ++i) ((Sys &lt; Vec2[i].x) &amp;&amp; (SegmentTree::DoModify(1, 1, n, Sys, Vec2[i].x - 1, val, opt), 1)), Sys = Vec2[i].y + 1;
            if (Sys &lt;= n) SegmentTree::DoModify(1, 1, n, Sys, n, val, opt);
        }

        void main() {
            read(n, m);
            for (int i = 1, x, y; i &lt; n; ++i) read(x, y), add(x, y), add(y, x);
            dfs1(1, 0), dfs2(1, 1);
            for (int i = 1, x, y, k, t, opt; i &lt;= m; ++i) {
                read(opt);
                if (opt == 0) read(x, y, k), ModifySubTree(x, y, k, 1), tx[i] = x, ty[i] = y, tk[i] = k;
                else if (opt == 1) read(t), ModifySubTree(tx[t], ty[t], tk[t], 0);
                else if (opt == 2) read(x), write(io_l, SegmentTree::GetAnswer(1, 1, n, dfn[x]));
            }
        }
    } // namespace TreeChainSplittin
    } // namespace IamJustForPlaying
    } // namespace IamJustForPlaying
    } // namespace IamJustForPlaying
    } // namespace IamJustForPlaying
    } // namespace IamJustForPlaying
    } // namespace IamJustForPlaying
    } // namespace IamJustForPlaying
} // namespace HNOI2016_Network

signed main() {
    HNOI2016_Network::IamJustForPlaying::IamJustForPlaying::IamJustForPlaying::IamJustForPlaying::IamJustForPlaying::IamJustForPlaying::IamJustForPlaying::TreeChainSplitting::main();
}
</code></pre>
<h1 id="24-P4211-LNOI2014-LCA"><a href="#24-P4211-LNOI2014-LCA" class="headerlink" title="24.P4211 [LNOI2014]LCA"></a>24.P4211 [LNOI2014]LCA</h1><p>???????n????????????????????0??n-1????????0?????????????????????????????????+1??<br>??dep[i]?????i???????LCA(i,j)???i??j???????????????<br>??q???????????????l r z????$\sum_{l \leq i \leq r}dep[LCA(i,z)]$</p>
<hr>
<p>???????????????????????+1?????l??r???????????????</p>
<p>??????????????????????+1????</p>
<p>?????????????</p>
<p>???????????????????????????????????????????? $[1,r]-[1,l-1]$</p>
<p>?????????l-1??r??????????????????????????????????????????</p>
<p>??????????????????????????????????????n???????Log??n??</p>
<p>(?????????????????????????????????luogu??T?????lojA???????????luoguA?????lojT???)</p>
<p>(??????????????????????????????????????)</p>
<pre><code class="lang-cpp">#pragma GCC diagnostic error &quot;-std=c++11&quot;
#include &lt;cstdio&gt;
#include &lt;iostream&gt;
#include &lt;algorithm&gt;
#include &lt;cstring&gt;
#include &lt;queue&gt;
#define IT vector &lt; int &gt;::iterator
#define ForGraph int i = Head[x], y = Vert[i]; i; i = Next[i], y = Vert[i]
#define CheckSize ((size[son[x]] &lt; size[y]) &amp;&amp; (son[x] = y))
#define TCS TreeChainSplitting
#define CFS ChainForwardStar
#define PS ProblemSolver
#define pii pair &lt; int , int &gt;
#define pll pair &lt; LL, LL &gt;
#define mid ((l + r) &gt;&gt; 1)
#define mp make_pair
#define fir first
#define sec second
#define pub push_back
#define pob pop_back

using namespace std;
typedef long long LL;

#define io_e &#39;\0&#39;
#define io_s &#39; &#39;
#define io_l &#39;\n&#39;
 #define _DEBUG_ 1 // debug toggle
namespace Fast_IO {
    #ifndef _DEBUG_
        #define gc() (iS == iT ? (iT = (iS = ibuff) + fread(ibuff, 1, SIZ, stdin), (iS == iT ? EOF : *iS++)) : *iS++)
    #else
        #define gc() getchar()
    #endif
    const int SIZ = 1 &lt;&lt; 21 | 1;
    char *iS, *iT, ibuff[SIZ], obuff[SIZ], *oS = obuff, *oT = oS + SIZ - 1, fu[110], c;
    int fr;
    inline void ioout() {
        fwrite(obuff, 1, oS - obuff, stdout);
        oS = obuff;
    }
    template &lt;class Type&gt;
    inline void read(Type&amp; x) {
        x = 0;
        Type y = 1;
        for (c = gc(); (c &gt; &#39;9&#39; || c &lt; &#39;0&#39;) &amp;&amp; c ^ &#39;-&#39;; c = gc())
            ;
        c == &#39;-&#39; ? y = -1 : x = (c &amp; 15);
        for (c = gc(); c &gt;= &#39;0&#39; &amp;&amp; c &lt;= &#39;9&#39;; c = gc()) x = x * 10 + (c &amp; 15);
        x *= y;
    }
    inline bool blank(char ch) { return ch == &#39; &#39; || ch == &#39;\n&#39; || ch == &#39;\r&#39; || ch == &#39;\t&#39;; }
    inline void read(char* s) {
        register char ch = gc();
        for (; blank(ch); ch = gc())
            ;
        for (; !blank(ch); ch = gc()) *s++ = ch;
        *s = 0;
    }
    inline void read(char&amp; c) {
        for (c = gc(); blank(c); c = gc())
            ;
    }
    template &lt;typename Type, typename... Args&gt;
    inline void read(Type&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char* t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;class Type&gt;
    inline void write(char lastChar, Type x) {
        if (x &lt; 0)
            *oS++ = &#39;-&#39;, x = -x;
        if (x == 0)
            *oS++ = &#39;0&#39;;
        while (x) fu[++fr] = x % 10 + &#39;0&#39;, x /= 10;
        while (fr) *oS++ = fu[fr--];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x[]) {
        for (register int i = 0; x[i]; ++i) *oS++ = x[i];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x) {
        *oS++ = x;
        *oS++ = lastChar;
        ioout();
    }
    template &lt;typename Type, typename... Args&gt;
    inline void write(char midChar, Type t, Args... args) {
        write(midChar, t), write(midChar, args...);
    }
}  // namespace Fast_IO

using Fast_IO::read;
using Fast_IO::write;

const int SIZE = 5e4 + 5;
namespace ChainForwardStar {
    const int SIZE = ::SIZE;
    int tot_, Vert[SIZE];
    int Head[SIZE], Next[SIZE];

    void AddLine(int x, int y) {
        Vert[++tot_] = y;
        Next[tot_] = Head[x];
        Head[x] = tot_;
    }
} // namespace ChainForwardStar

using CFS::Head;
using CFS::Vert;
using CFS::Next;
using CFS::AddLine;

namespace TreeChainSplitting {
    const int SIZE = ::SIZE;
    const int MOD = 201314;
    int n, m, tot, d[SIZE];
    int fa[SIZE], size[SIZE];
    int son[SIZE], top[SIZE];
    int dfn[SIZE], rnk[SIZE];
    int ask[SIZE], ans[SIZE];
    vector &lt; int &gt; GFY[SIZE];
    vector &lt; int &gt; FI[SIZE];
    int sum[SIZE &lt;&lt; 2], lf[SIZE &lt;&lt; 2];

    void Prepare(int x) {
        size[x] = 1, d[x] = d[fa[x]] + 1;
        for (ForGraph)
            Prepare(y), size[x] += size[y], CheckSize;
    }

    void Prepare(int x, int tp) {
        rnk[dfn[x] = ++tot] = x, top[x] = tp;
        if (son[x]) Prepare(son[x], tp);
        for (ForGraph) if (y ^ son[x]) Prepare(y, y);
    }

    #define ls (k &lt;&lt; 1)
    #define rs (k &lt;&lt; 1 | 1)
    #define L_RECUR ls, l, mid, x, y
    #define R_RECUR rs, mid + 1, r, x, y
    #define UpdateSons(k, l, r) if (lf[k]) sum[ls] = (sum[ls] + 1LL * lf[k] * (mid - l + 1) % MOD) % MOD,                    \
                                sum[rs] = (sum[rs] + 1LL * lf[k] * (r - mid) % MOD) % MOD, lf[ls] += lf[k],                    \
                                lf[rs] += lf[k], lf[k] = 0
    #define UpdateMessages(k) sum[k] = (sum[ls] + sum[rs]) % MOD
    void ModifyChain(int k, int l, int r, int x, int y) {
        if (l &gt;= x &amp;&amp; r &lt;= y) sum[k] = (sum[k] + r - l + 1) % MOD, ++lf[k];
        else {
            UpdateSons(k, l, r);
            if (mid &gt;= x) ModifyChain(L_RECUR);
            if (mid &lt; y) ModifyChain(R_RECUR);
            UpdateMessages(k);
        }
    }

    void ModifySubTree(int x) {
        if (x) ModifyChain(1, 1, n, dfn[top[x]], dfn[x]), ModifySubTree(x = fa[top[x]]);
    }

    int QueryChain(int k, int l, int r, int x, int y, int res = 0) {
        if (l &gt;= x &amp;&amp; r &lt;= y) return sum[k];
        UpdateSons(k, l, r);
        if (mid &gt;= x) res += QueryChain(L_RECUR, 0);
        if (mid &lt; y) res += QueryChain(R_RECUR, 0);
        return res;
    }

    int QuerySubTree(int x, int res = 0) { // luogu-only 
        if (x) QuerySubTree((res += QueryChain(1, 1, n, dfn[top[x]], dfn[x]), x = fa[top[x]]), res); else return res;
    }

//    int QuerySubTree(int x, int res = 0) { // loj-only
//        while (x) {
//            res += QueryChain(1, 1, n, dfn[top[x]], dfn[x]);
//            x = fa[top[x]];
//        }
//        return res;
//    }
} // namespace TreeChainSplitting

namespace ProblemSolver {
    void main() {
        read(TCS::n), read(TCS::m);
        for (int i = 2; i &lt;= TCS::n; ++i) read(TCS::fa[i]), AddLine(++TCS::fa[i], i);
        TCS::Prepare(1), TCS::tot = 0, TCS::Prepare(1, 1);
        int L, R;
        for (int i = 1; i &lt;= TCS::m; ++i) read(L, R, TCS::ask[i]), TCS::FI[L].push_back(i), TCS::GFY[R + 1].push_back(i), ++TCS::ask[i];
        for (int i = 1; i &lt;= TCS::n; ++i) {
            TCS::ModifySubTree(i);
            for (auto it : TCS::GFY[i]) TCS::ans[it] += TCS::QuerySubTree(TCS::ask[it]);
            for (auto it : TCS::FI[i]) TCS::ans[it] -= TCS::QuerySubTree(TCS::ask[it]);
        }
        for (int i = 1; i &lt;= TCS::m; ++i) write(io_l, (TCS::ans[i] % TCS::MOD + TCS::MOD) % TCS::MOD);
    }
} // namespace ProblemSover

signed main() {
    PS::main();
}
</code></pre>
<h1 id="25-2018-Day-3"><a href="#25-2018-Day-3" class="headerlink" title="25.??2018 ???????? Day 3????????????????"></a>25.??2018 ???????? Day 3????????????????</h1><h1 id><a href="#" class="headerlink" title="???"></a>???</h1><p>????????????????????????????????????????????????????????</p>
<p>??????????????????????</p>
<blockquote>
<p>Day1:??????????????????????????????????????????????????????????????</p>
<p>Day2:cow?????????????????????LCT????????????????????????????????????????????????</p>
<p>Day3???????cow????????????????2????(<a href="https://www.orchid-any.cf/">??????</a>)????????????????????</p>
<p>Day4:?????????????????????????????????????????????????(???????????????)?????????</p>
<p>Day5???????????5?????????????????????????</p>
</blockquote>
<h1 id="-1"><a href="#-1" class="headerlink" title="????"></a>????</h1><h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><blockquote>
<p>?????????????????????????????????</p>
</blockquote>
<p>?????????????????</p>
<p>??????????????????????????????????? LCR ??????????????</p>
<p>?????????????????????????????????????????????????????????????????</p>
<p>?????????? LCR ???????? ???? ?????????????????????????????????? K ????????????????????????????????????????????</p>
<p>??????????????????????????????????????????????????????????????????LCR ????????? $1$????????????????????????????????????????????????????LCR ????????????????????????????? $n$ ?????????????</p>
<p>???????????????????????????????????????????????????? $u$ ??????????????????????????? $v$ ?????? $u,v$ ??????????????????????? $u,v$ ???????? $\min(u,v)$ ?????</p>
<p>???????????????????LCR ???????????????????????????????????? $u,v$?????? $u$ ??????? $v$ ?????????????</p>
<p>??????????????????????????????????????????????????????????????</p>
<p>???????????????????????????????????? LCR ?????????</p>
<p><em>????????????????????</em></p>
<p><em>?????????????????????????????????????????????</em></p>
<p>???????????????LCR ????????????????????????????????</p>
<p><em>??????????????????????????????????????????????????????? ???? ???????????????????????????</em></p>
<p><em>?????????????????</em></p>
<p>LCR ?????????????????????????????????????????????</p>
<p><em>??????????? ??????</em> ?????????????????????????????????????????????????????????X?m LCA ????????????</p>
<p><em>??????????????????????????????</em></p>
<p><em>???????????</em> ???????????????????????????<em>??LCR ??????????????????????????????????</em></p>
<p>LCA ???????????????????????????????????????</p>
<p><em>?????????????????????????????????????????????????????????????????????LCA??????????? ???? ??????????????????????????????????????</em></p>
<p>?????? LCA ????????????????????</p>
<p><em>???????????????</em></p>
<p>????????????????????????</p>
<p>????????????? LCR ??????????????</p>
<hr>
<h3 id="-2"><a href="#-2" class="headerlink" title="????"></a>????</h3><p>????????? $T=(V,E)$??$V$ ??????????????????????????????????????? $i$ ???????? $i$ ???</p>
<p>????????????<strong>???</strong>? $G(T)=(V,E’)$??$G(T)$ ?????????????????? $(u,v)\in E’$ ????????? $T$ ????????????????? $u,v$ ??? $x$ ???? $x$ ??? $u$ ?? $v$ ?????????????????????? $\min(u,v)$??</p>
<p>??????? $T$??????????????????? $1$?????????? $q$ ???????????????????????</p>
<ul>
<li>$\texttt{1 u v}$ ??????????????? $v$ ???????????? $u$ ??????????????????????????????????????????</li>
<li>$\texttt{2 u v}$ ?????? $G(T)$ ???? $u$ ?? $v$ ???????????????????? $1$????</li>
</ul>
<p>????????????????</p>
<hr>
<p>???????????????????????????????????????????????????????????????!</p>
<p>??????????????????</p>
<p>?????????????????????????????????????????????</p>
<p>????????????????????????????????????????????????????????????????????????????**??????Splay???????????????????????????????</p>
<p>????????????????????????????????????????????+???????????????????????????</p>
<p>???????????????????????????????????????????????????????????????????????????????<del>?????????????????Google??????</del>?????????????<br>?????????<a href="https://www.codeleading.com/article/774394821/" target="_blank" rel="noopener">Link</a></p>
<p>???????????????????????(404??????)</p>
<pre><code class="lang-cpp">#pragma GCC diagnostic error &quot;-std=c++11&quot;
#include &lt;cstdio&gt;
#include &lt;iostream&gt;
#include &lt;algorithm&gt;
#include &lt;cstring&gt;
#include &lt;queue&gt;
#define SIZE_CHECKER ((size[son[x]] &lt; size[y]) &amp;&amp; (son[x] = y))
#define pii pair &lt; int , int &gt;
#define pll pair &lt; LL, LL &gt;
#define mid ((l + r) &gt;&gt; 1)
#define mp make_pair
#define fir first
#define sec second
#define pub push_back
#define pob pop_back

using namespace std;
typedef long long LL;

#define io_e &#39;\0&#39;
#define io_s &#39; &#39;
#define io_l &#39;\n&#39;
//  #define _DEBUG_ 1 // debug toggle
namespace Fast_IO {
    #ifndef _DEBUG_
        #define gc() (iS == iT ? (iT = (iS = ibuff) + fread(ibuff, 1, SIZ, stdin), (iS == iT ? EOF : *iS++)) : *iS++)
    #else
        #define gc() getchar()
    #endif
    const int SIZ = 1 &lt;&lt; 21 | 1;
    char *iS, *iT, ibuff[SIZ], obuff[SIZ], *oS = obuff, *oT = oS + SIZ - 1, fu[110], c;
    int fr;
    inline void ioout() {
        fwrite(obuff, 1, oS - obuff, stdout);
        oS = obuff;
    }
    template &lt;class Type&gt;
    inline void read(Type&amp; x) {
        x = 0;
        Type y = 1;
        for (c = gc(); (c &gt; &#39;9&#39; || c &lt; &#39;0&#39;) &amp;&amp; c ^ &#39;-&#39;; c = gc())
            ;
        c == &#39;-&#39; ? y = -1 : x = (c &amp; 15);
        for (c = gc(); c &gt;= &#39;0&#39; &amp;&amp; c &lt;= &#39;9&#39;; c = gc()) x = x * 10 + (c &amp; 15);
        x *= y;
    }
    inline bool blank(char ch) { return ch == &#39; &#39; || ch == &#39;\n&#39; || ch == &#39;\r&#39; || ch == &#39;\t&#39;; }
    inline void read(char* s) {
        register char ch = gc();
        for (; blank(ch); ch = gc())
            ;
        for (; !blank(ch); ch = gc()) *s++ = ch;
        *s = 0;
    }
    inline void read(char&amp; c) {
        for (c = gc(); blank(c); c = gc())
            ;
    }
    template &lt;typename Type, typename... Args&gt;
    inline void read(Type&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char* t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;class Type&gt;
    inline void write(char lastChar, Type x) {
        if (x &lt; 0)
            *oS++ = &#39;-&#39;, x = -x;
        if (x == 0)
            *oS++ = &#39;0&#39;;
        while (x) fu[++fr] = x % 10 + &#39;0&#39;, x /= 10;
        while (fr) *oS++ = fu[fr--];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x[]) {
        for (register int i = 0; x[i]; ++i) *oS++ = x[i];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x) {
        *oS++ = x;
        *oS++ = lastChar;
        ioout();
    }
    template &lt;typename Type, typename... Args&gt;
    inline void write(char midChar, Type t, Args... args) {
        write(midChar, t), write(midChar, args...);
    }
}  // namespace Fast_IO

using Fast_IO::read;
using Fast_IO::write;

const int SIZE = 5e5 + 5;
vector &lt; vector &lt; int &gt; &gt; G(SIZE);
int n, m, st[SIZE], tp, F[SIZE];
int _time[SIZE], _down[SIZE];
int OP[SIZE], U[SIZE], V[SIZE];

void init(int n) {
    for (int i = 1; i &lt;= n; ++i)
        F[i] = i;
}

int find(int x) {
    if (x ^ F[x]) F[x] = find(F[x]);
    return F[x];
}

namespace CartesianTree {
    vector &lt; vector &lt; int &gt; &gt; GCT(SIZE);
    int son[SIZE], fa[SIZE];
    int top[SIZE], size[SIZE];
    int low[SIZE], d[SIZE];
    int tot, ls[SIZE], rs[SIZE];

    void Prepare1(int x) {
        while (_time[st[tp]] &gt; _time[x] &amp;&amp; tp) _down[st[tp--]] = x;
        st[++tp] = x;
        size[x] = 1;
        d[x] = d[fa[x]] + 1;
        for (auto y : GCT[x])
            Prepare1((fa[y] = x, y)), size[x] += size[y], SIZE_CHECKER;
    }

    void Prepare2(int x) {
        ls[x] = ++tot;
        if (!top[x]) top[x] = x;
        if (!son[x]) return (void)(rs[x] = tot);
        top[son[x]] = top[x];
        for (auto y : GCT[x]) Prepare2(y);
        rs[x] = tot;
    }

    int GetLCA(int x, int y) {
        while (top[x] ^ top[y])
            d[top[x]] &gt; d[top[y]] ? x = fa[top[x]] : y = fa[top[y]];
        return d[x] &lt; d[y] ? x : y;
    }

    int Behavior(int x, int y) {
        while (top[x] ^ top[y]) if (fa[x = top[x]] ^ y) x = fa[x]; else return x;
        return son[y];
    }

    bool FindRule(int x, int y) {
        return ls[x] &lt; ls[y];
    }

    bool CheckForFun(int x, int y) {
        int std = *(upper_bound(GCT[y].begin(), GCT[y].end(), x, FindRule) - 1);
        return !(ls[low[std]] &gt; rs[x] || ls[x] &gt; ls[low[std]]);
    }

    void Main() {
        init(n);
        for (int i = 1; i &lt;= n; ++i)
            for (auto j : G[i])
                if (i &gt; find(j)) GCT[i].pub(find(j)), F[find(j)] = i;
        Prepare1(n), Prepare2(n);
        for (int i = 1; i &lt;= n; ++i)
            for (auto j : G[i])
                if (i &gt; j) low[Behavior(j, i)] = j;
    }
} // namespace CartesianTree
#define CT CartesianTree

namespace LinkCutTree {
    struct SPLAY {
        int ch[2];
        int fa;
        int sum;
        int key;
    } data[SIZE];
    int next[SIZE], root[SIZE];
    #define WhichSon(x) (data[data[x].fa].ch[1] == x)

    void UpdateMessages(int x) {
        data[x].sum = data[data[x].ch[0]].sum + data[data[x].ch[1]].sum + data[x].key;
    }

    void RotateNode(int x) {
        int y = data[x].fa, z = data[y].fa;
        int k = WhichSon(x);
        if (root[y]) root[y] = 0, root[x] = root[y] ^ 1;
        else data[z].ch[data[z].ch[1] == y] = x;
        data[x].fa = data[y].fa;
        data[y].ch[k] = data[x].ch[k ^ 1];
        if (data[y].ch[k]) data[data[x].ch[k ^ 1]].fa = y;
        data[x].ch[k ^ 1] = y;
        data[y].fa = x;
        UpdateMessages(y), UpdateMessages(x);
    }

    void SplayToRoot(int x) {
        for (int y; !root[x]; RotateNode(x))
            if (!root[y = data[x].fa])
                RotateNode(data[data[y].fa].ch[0] ^ y ^ data[y].ch[0] ^ x ? x : y);
    }

    void AccessEdge(int x) {
        for (int y = 0; x; x = data[y = x].fa) {
            SplayToRoot(x);
            if (data[x].ch[1]) root[data[x].ch[1]] = 1;
            if (data[x].ch[1] = y) root[y] = 0;
            UpdateMessages(x);
        }
    }

    void Behavior(int u, int v) {
        if (u &gt; v) {
            F[v] = u;
            data[v].fa = u;
            data[v].key = 1;
            data[v].sum = 1;
            return ;
        }
        int x = _down[v], rhs = u;
        SplayToRoot(x);
        int rsp = 0, cpy = 0, now = data[x].ch[0];
        if (now) {
            while (data[now].ch[1]) now = data[now].ch[1];
            SplayToRoot(now);
            while (data[x].fa ^ now) RotateNode(x);
            root[x] = 1;
            data[now].ch[1] = 0;
            UpdateMessages(now);
        }
        now = data[x].fa;
        if (next[now] == x) next[now] = v;
        data[v].key = data[v].sum = data[x].key;
        if (now) next[v] = x;
        SplayToRoot(x);
        data[x].fa = v;
        data[v].fa = now;
        data[x].key = 0;
        UpdateMessages(x);

        while (u) {
            SplayToRoot(u);
            if (data[u].ch[1]) root[data[u].ch[1]] = 1;
            data[u].ch[1] = rsp;
            if (data[u].ch[1]) root[rsp] = 0;
            UpdateMessages(u);
            if (data[u].sum) {
                x = u;
                while (233)
                    if (data[x].ch[1] &amp;&amp; data[data[x].ch[1]].sum) x = data[x].ch[1];
                    else if (!data[x].key) x = data[x].ch[0];
                    else break;
                SplayToRoot(x);
                if (x &gt;= v) break;
                u = data[x].ch[0];
                if (u) {
                    while (data[u].ch[1]) u = data[u].ch[1];
                    SplayToRoot(u);
                    data[u].ch[1] = 0;
                    root[x] = 1;
                    UpdateMessages(u);
                }
                else u = data[x].fa;
                if (u &gt;= v) break;
                SplayToRoot(rhs);
                if (now = data[rhs].ch[1]) root[now] = 1, data[rhs].ch[1] = 0;
                if (now = next[rhs]) {
                    SplayToRoot(now);
                    data[now].fa = u;
                    data[now].key = 1;
                    UpdateMessages(now);
                    next[rhs] = 0;
                }
                u = F[x];
                rhs = F[x];
                data[x].key = 0;
                UpdateMessages(x);
                SplayToRoot(x);
                while (data[x].ch[1]) x = data[x].ch[1];
                SplayToRoot(x);
                data[x].ch[1] = cpy;
                if (data[x].ch[1]) {
                    data[cpy].fa = x, root[cpy] = 0, data[x].ch[1] = cpy;
                    while (data[cpy].ch[0]) cpy = data[cpy].ch[0];
                    next[x] = cpy;
                    SplayToRoot(cpy);
                }
                SplayToRoot(x);
                cpy = x;
                rsp = 0;
            }
            else rsp = u, u = data[u].fa;
        }
        F[v] = F[_down[v]];
        F[_down[v]] = v;
        if (!F[v]) {
            SplayToRoot(v);
            x = v;
            while (data[x].ch[1]) x = data[x].ch[1];
            if (cpy) {
                data[x].ch[1] = cpy;
                root[cpy] = 0;
                data[cpy].fa = x;
                while (data[cpy].ch[0]) cpy = data[cpy].ch[0];
                next[x] = cpy;
                SplayToRoot(cpy);
            }
            SplayToRoot(v);
            x = data[v].ch[1];
            while (data[x].ch[0]) x = data[x].ch[0];
            data[x].key = 1;
            UpdateMessages(x);
            SplayToRoot(x);
        }
        else if (cpy) {
            x = cpy;
            while (data[x].ch[0]) x = data[x].ch[0];
            data[x].key = 1;
            UpdateMessages(x);
            SplayToRoot(x);
            data[x].fa = v;
        }
    }

    pii GetDis(int x, int t) {
        if (x ^ t) {
            AccessEdge(x);
            SplayToRoot(x);
            int st = x;
            int fir = 0, sec = 0;
            while (x)
                if (x &lt; t) sec = x, x = data[x].ch[0];
                else x = data[x].ch[1];
            SplayToRoot(sec);
            x = data[sec].ch[1];
            fir = data[x].sum;
            if (!fir) return mp(0, st);
            while (233) {
                if (data[data[x].ch[0]].sum) x = data[x].ch[0];
                else if (!data[x].key) sec = x, x = data[x].ch[1];
                else {
                    if (data[x].ch[0]) {
                        x = data[x].ch[0];
                        while (data[x].ch[1]) x = data[x].ch[1];
                        sec = x;
                    }
                    break;
                }
            }
            return mp(fir, sec);
        }
        else return mp(0, x);
    }

    int GetAnswers(int x, int y) {
        if (x ^ y) {
            if (x &gt; y) x ^= y ^= x ^= y;
            int sys = CT::GetLCA(x, y);
            if (sys ^ y) {
                pii t1 = GetDis(x, sys);
                pii t2 = GetDis(y, sys);
                return t1.fir + t2.fir + ((CT::CheckForFun(t1.sec, sys)
                     &amp;&amp; CT::CheckForFun(t2.sec, sys)) ^ 1) + 2;
            }
            else {
                pii t = GetDis(x, sys);
                return t.fir + (CT::CheckForFun(t.sec, sys) ^ 1) + 1;
            }
        }
        else return 0;
    }
} // namespace LinkCutTree
#define LCT LinkCutTree

namespace SOLVER {
    void Main() {
        read(m), read(m);
        n = 1;
        for (int i = 1; i &lt;= m; ++i) {
            read(OP[i], U[i], V[i]);
            if (OP[i] ^ 1) continue;
            G[U[i]].pub(V[i]);
            G[V[i]].pub(U[i]);
            _time[V[i]] = i;
            n = max(n, V[i]);
        }
        for (int i = 1; i &lt;= n; ++i) LCT::root[i] = true;
        CT::Main();
        F[1] = 0;
        for (int i = 1; i &lt;= m; ++i) {
            if (OP[i] ^ 2) LCT::Behavior(U[i], V[i]);
            else write(io_l, LCT::GetAnswers(U[i], V[i]));
        }
    }
}

signed main() {
    SOLVER::Main();
}
</code></pre>
<h1 id="26-P1121"><a href="#26-P1121" class="headerlink" title="26.P1121 ????????????????"></a>26.P1121 ????????????????</h1><p>?????????????????????$A_1$??$A_N$??????????????????????????????????????????????????</p>
<hr>
<p>????????????:</p>
<blockquote>
<p>???</p>
<p>????</p>
<p>?????????</p>
</blockquote>
<p>??????????DP????????????????????????????!</p>
<p>????????????????????????????????????????</p>
<p>???????????????????????????????????????????????????????</p>
<p>??????????????????</p>
<p>?????????????????????</p>
<p>????????????<del>???</del></p>
<p>???????????????????????????????????????5??????????????????????????????????????????</p>
<p><img src="https://i.loli.net/2020/02/07/cM8KnGyrefCLwRk.png" alt="Annotation 2020-02-07 210659.png"></p>
<p>???????????????????????????????????</p>
<ol>
<li>??????</li>
<li>??????????</li>
<li>???????????</li>
<li>?????????????</li>
<li>??????????+???</li>
<li>????????????+???</li>
<li>??????????+????</li>
<li>?????????????????</li>
</ol>
<p><del>???????????????????????????</del></p>
<p>???????????????????</p>
<pre><code class="lang-cpp">// ????????????????????

const int SIZE = 4e5 + 5;
const int INF = ~0U &gt;&gt; 1;
struct TreeNode { // ?????????????????
    int sum;
    int maxSum;
    int maxSumDouble;
    int maxPrefixSum;
    int maxSuffixSum;
    int maxPrePlusSuf;
    int maxPrePlusMid;
    int maxSufPlusMid;
} data[SIZE&lt;&lt;2];
int ints[SIZE&lt;&lt;1], ans = -INF, n;

TreeNode UpdateMessages(TreeNode x, TreeNode y) { // ???????
    TreeNode res;
    res.sum = x.sum + y.sum; // ????????????
    res.maxSum = max(x.maxSum, y.maxSum); // // ???????????????????
    res.maxSum = max(res.maxSum, x.maxSuffixSum + y.maxPrefixSum); // ??????????????????????/?????????
    res.maxPrefixSum = max(x.maxPrefixSum, x.sum + y.maxPrefixSum); // ????????????
    res.maxSuffixSum = max(y.maxSuffixSum, y.sum + x.maxSuffixSum); // ???????????????
    res.maxPrePlusSuf = max(x.maxPrefixSum + y.maxSuffixSum, x.sum + y.maxPrePlusSuf); // ????????????????
    res.maxPrePlusSuf = max(res.maxPrePlusSuf, y.sum + x.maxPrePlusSuf);
    res.maxPrePlusMid = max(x.maxPrePlusMid, x.sum + y.maxPrePlusMid);
    res.maxPrePlusMid = max(res.maxPrePlusMid, x.maxPrefixSum + y.maxSum);
    res.maxPrePlusMid = max(res.maxPrePlusMid, x.maxPrePlusSuf + y.maxPrefixSum);
    res.maxSufPlusMid = max(y.maxSufPlusMid, y.sum + x.maxSufPlusMid);
    res.maxSufPlusMid = max(res.maxSufPlusMid, y.sum + x.maxSum);
    res.maxSufPlusMid = max(res.maxSufPlusMid, y.maxPrePlusSuf + x.maxSuffixSum);
    res.maxSumDouble = max(x.maxSumDouble, y.maxSumDouble);
    res.maxSumDouble = max(res.maxSumDouble, x.maxSum + y.maxSum);
    res.maxSumDouble = max(res.maxSumDouble, x.maxSufPlusMid + y.maxPrefixSum);
    res.maxSumDouble = max(res.maxSumDouble, x.maxSuffixSum + y.maxPrePlusMid);
    return res;
}

void Initialization(int k, int l) { // ??????????????
    data[k].sum = data[k].maxPrefixSum = data[k].maxSuffixSum = data[k].maxSum = ints[l];
    data[k].maxSumDouble = data[k].maxPrePlusSuf = data[k].maxPrePlusMid = data[k].maxSufPlusMid = -INF;
} 

void BuildTree(int k, int l, int r) {
    if (l ^ r) BuildTree(ls, l, mid), BuildTree(rs, mid + 1, r), data[k] = UpdateMessages(data[ls], data[rs]);
    else Initialization(k, l);
}

TreeNode GetAnswers(int k, int l, int r, int x, int y) {
    if (l ^ x || r ^ y) {
        if (mid &gt;= y) return GetAnswers(ls, l, mid, x, y);
        if (mid &lt; x) return GetAnswers(rs, mid + 1, r, x, y);
        return UpdateMessages(GetAnswers(ls, l, mid, x, mid), GetAnswers(rs, mid + 1, r, mid + 1, y));
    } else return data[k];
}

signed main() {
    read(n);
    for (int i = 1; i &lt;= n; ++i) read(ints[i]), ints[i + n] = ints[i];
    BuildTree(1, 1, n &lt;&lt; 1);
    for (int i = 1; i &lt;= n; ++i) ans = max(ans, GetAnswers(1, 1, n &lt;&lt; 1, i, i + n - 1).maxSumDouble);
    write(io_l, ans);
}
</code></pre>
<h1 id="27"><a href="#27" class="headerlink" title="27.??????????????????"></a>27.??????????????????</h1><p>?? Z ?????????????????t????????? $K$ ??????????? Z ??????????????????????????????????????????????????? Z ????? $K$ ????????????????????? Z ????????????????????????</p>
<p>?? Z ?????????????????????? $N$ ??????????????????? $1\ldots N$???? $i$ ????????????? $a[i]$ ????????????????????????????????????????????????????????????????????????????</p>
<p>?????? Z ????? $N$ ?????????????????? $K$ ????? $K$ ????????? Z ????????????????????????????????????????????????????????</p>
<hr>
<p>????????????????</p>
<p>??????????????????????</p>
<p>??????????check????dp??$dp_i$ ????? $[1,i]$ ??????????????</p>
<p>dp???????? $dp_i=max{dp_j}+1$??</p>
<p>????????? $\Theta(n^2)$ ??????T????</p>
<p>?????????????????????????????????????????</p>
<p>??????? $\Theta(n\log^2n)$</p>
<pre><code class="lang-cpp">#pragma GCC diagnostic error &quot;-std=c++11&quot;
#include &lt;cstdio&gt;
#include &lt;iostream&gt;
#include &lt;algorithm&gt;
#include &lt;cstring&gt;
#include &lt;queue&gt;
#define ls (k &lt;&lt; 1)
#define rs (k &lt;&lt; 1 | 1)
#define SIZE_CHECKER(x, y) ((size[son[x]] &lt; size[y]) &amp;&amp; (son[x] = y))
#define PII pair &lt; __int64 , __int64 &gt;
#define PLL pair &lt; LL, LL &gt;
#define mid ((l + r) &gt;&gt; 1)
#define mp make_pair
#define fir first
#define sec second
#define pb push_back
#define R register

using namespace std;
#ifndef __int8
    typedef char __int8;
#endif
#ifndef __uint8
    typedef unsigned char __uint8;
#endif
#ifndef __int16
    typedef short __int16;
#endif
#ifndef __uint16
    typedef unsigned short __uint16;
#endif
#ifndef __int32
    typedef int __int32;
#endif
#ifndef __int64
    typedef long long __int64;
#endif
#ifndef __uint32
    typedef unsigned int __uint32;
#endif
#ifndef __uint64
    typedef unsigned long long __uint64;
#endif

#define io_e &#39;\0&#39;
#define io_s &#39; &#39;
#define io_l &#39;\n&#39;
 #define _DEBUG_ 1 // debug toggle
namespace Fast_IO {
    #ifndef _DEBUG_
        #define gc() (iS == iT ? (iT = (iS = ibuff) + fread(ibuff, 1, SIZ, stdin), (iS == iT ? EOF : *iS++)) : *iS++)
    #else
        #define gc() getchar()
    #endif
    const __int64 SIZ = 1 &lt;&lt; 21 | 1;
    char *iS, *iT, ibuff[SIZ], obuff[SIZ], *oS = obuff, *oT = oS + SIZ - 1, fu[110], c;
    __int64 fr;
    inline void ioout() {
        fwrite(obuff, 1, oS - obuff, stdout);
        oS = obuff;
    }
    template &lt;class Type&gt;
    inline void read(Type&amp; x) {
        x = 0;
        Type y = 1;
        for (c = gc(); (c &gt; &#39;9&#39; || c &lt; &#39;0&#39;) &amp;&amp; c ^ &#39;-&#39;; c = gc())
            ;
        c == &#39;-&#39; ? y = -1 : x = (c &amp; 15);
        for (c = gc(); c &gt;= &#39;0&#39; &amp;&amp; c &lt;= &#39;9&#39;; c = gc()) x = x * 10 + (c &amp; 15);
        x *= y;
    }
    inline bool blank(char ch) { return ch == &#39; &#39; || ch == &#39;\n&#39; || ch == &#39;\r&#39; || ch == &#39;\t&#39;; }
    inline void read(char* s) {
        register char ch = gc();
        for (; blank(ch); ch = gc())
            ;
        for (; !blank(ch); ch = gc()) *s++ = ch;
        *s = 0;
    }
    inline void read(char&amp; c) {
        for (c = gc(); blank(c); c = gc())
            ;
    }
    template &lt;typename Type, typename... Args&gt;
    inline void read(Type&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char* t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;class Type&gt;
    inline void write(char lastChar, Type x) {
        if (x &lt; 0)
            *oS++ = &#39;-&#39;, x = -x;
        if (x == 0)
            *oS++ = &#39;0&#39;;
        while (x) fu[++fr] = x % 10 + &#39;0&#39;, x /= 10;
        while (fr) *oS++ = fu[fr--];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x[]) {
        for (register __int64 i = 0; x[i]; ++i) *oS++ = x[i];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x) {
        *oS++ = x;
        *oS++ = lastChar;
        ioout();
    }
    template &lt;typename Type, typename... Args&gt;
    inline void write(char midChar, Type t, Args... args) {
        write(midChar, t), write(midChar, args...);
    }
}  // namespace Fast_IO

using Fast_IO::read;
using Fast_IO::write;

const __int64 SIZE = 1e6 + 5;
const __int64 INF = 0x7fffffff;
__int64 a[SIZE], bit[SIZE];
__int64 dp[SIZE], n, k, T;
vector &lt; __int64 &gt; disc;

void add(__int64 x, __int64 y) { for (; x &gt; 0; x -= x &amp; -x) bit[x] = max(bit[x], y); }
__int64 ask(__int64 x, __int64 lim, __int64 res = -INF) { for (; x &lt; lim; x += x &amp; -x) res = max(res, bit[x]); return res; }

void Discretization(__int64 x) {
    disc.clear();
    disc.pb(0);
    for (__int64 i = 1; i &lt;= n; ++i) disc.pb(a[i]);
    sort(disc.begin(), disc.end());
    disc.erase(unique(disc.begin(), disc.end()), disc.end());
} 

bool Check(__int64 x) {
    Discretization(x);
    for (__int64 i = 1; i &lt;= (__int64)disc.size(); ++i) {
        for (__int64 j = i; j &lt; (__int64)disc.size(); j += j &amp; -j) bit[i] = -INF;
        for (__int64 j = i; j &gt; 0; j -= j &amp; -j) bit[i] = -INF;
    }
    *dp = 0;
    add(lower_bound(disc.begin(), disc.end(), 0) - disc.begin() + 1, *dp);
    for (__int64 i = 1; i &lt;= n; ++i) {
        dp[i] = ask(lower_bound(disc.begin(), disc.end(), a[i] - x) - disc.begin() + 1, disc.size() + 1) + 1;
        add(lower_bound(disc.begin(), disc.end(), a[i]) - disc.begin() + 1, dp[i]);
        if (k &lt;= dp[i]) return 1;
    }
    return 0;
}

signed main() {
    for (read(T); T; --T) {
        read(n, k);
        for (__int64 i = 1; i &lt;= n; ++i) read(a[i]), a[i] += a[i - 1];
        __int64 l = -INF * SIZE, r = SIZE * INF;
        while (l &lt; r - 1)
            if (Check(mid)) r = mid;
            else l = mid;
        write(io_l, r);
    }
    return 0;
}
</code></pre>
<h1 id="28-P2163-SHOI2007"><a href="#28-P2163-SHOI2007" class="headerlink" title="28.P2163 [SHOI2007]????????"></a>28.P2163 [SHOI2007]????????</h1><p>???????????????????????????????????????????????????????????????????????????????????????????????????</p>
<p>?????????????????????????????????????????? ???????????????????????????????????????????????????????</p>
<p>???????????????????????????????????????????????????????????????</p>
<p>???????????????????????????????????????????????</p>
<p>?????????????????????????????????N?4002???????????????????????????????????</p>
<p>????????????????????????</p>
<p>?????????????????????????????????????????OI?????????????????????????????? ????????????????????????????????</p>
<p>???????????????????????????????????????????????????????????????? ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????</p>
<p>???????????????????????????????????????????????????????????????????????????????????????????????????</p>
<hr>
<p>?????????????????????????</p>
<p>??????????????????????????</p>
<p>?????x????????????????????????insert?????</p>
<p>??????????????????????????l??r</p>
<p>??????root[r]-root[l-1]?????</p>
<pre><code class="lang-cpp">#pragma GCC diagnostic error &quot;-std=c++11&quot;
#include &lt;cstdio&gt;
#include &lt;iostream&gt;
#include &lt;algorithm&gt;
#include &lt;cstring&gt;
#include &lt;queue&gt;
#define ls (data[rt].l)
#define rs (data[rt].r)
#define SIZE_CHECKER(x, y) ((size[son[x]] &lt; size[y]) &amp;&amp; (son[x] = y))
#define PII pair &lt; int , int &gt;
#define PLL pair &lt; LL, LL &gt;
#define mid ((l + r) &gt;&gt; 1)
#define mp make_pair
#define fir first
#define sec second
#define pb push_back
#define R register

using namespace std;
#ifndef __int8
    typedef char __int8;
#endif
#ifndef __uint8
    typedef unsigned char __uint8;
#endif
#ifndef __int16
    typedef short __int16;
#endif
#ifndef __uint16
    typedef unsigned short __uint16;
#endif
#ifndef __int32
    typedef int __int32;
#endif
#ifndef __int64
    typedef long long __int64;
#endif
#ifndef __uint32
    typedef unsigned int __uint32;
#endif
#ifndef __uint64
    typedef unsigned long long __uint64;
#endif

#define io_e &#39;\0&#39;
#define io_s &#39; &#39;
#define io_l &#39;\n&#39;
 #define _DEBUG_ 1 // debug toggle
namespace Fast_IO {
    #ifndef _DEBUG_
        #define gc() (iS == iT ? (iT = (iS = ibuff) + fread(ibuff, 1, SIZ, stdin), (iS == iT ? EOF : *iS++)) : *iS++)
    #else
        #define gc() getchar()
    #endif
    const int SIZ = 1 &lt;&lt; 21 | 1;
    char *iS, *iT, ibuff[SIZ], obuff[SIZ], *oS = obuff, *oT = oS + SIZ - 1, fu[110], c;
    int fr;
    inline void ioout() {
        fwrite(obuff, 1, oS - obuff, stdout);
        oS = obuff;
    }
    template &lt;class Type&gt;
    inline void read(Type&amp; x) {
        x = 0;
        Type y = 1;
        for (c = gc(); (c &gt; &#39;9&#39; || c &lt; &#39;0&#39;) &amp;&amp; c ^ &#39;-&#39;; c = gc())
            ;
        c == &#39;-&#39; ? y = -1 : x = (c &amp; 15);
        for (c = gc(); c &gt;= &#39;0&#39; &amp;&amp; c &lt;= &#39;9&#39;; c = gc()) x = x * 10 + (c &amp; 15);
        x *= y;
    }
    inline bool blank(char ch) { return ch == &#39; &#39; || ch == &#39;\n&#39; || ch == &#39;\r&#39; || ch == &#39;\t&#39;; }
    inline void read(char* s) {
        register char ch = gc();
        for (; blank(ch); ch = gc())
            ;
        for (; !blank(ch); ch = gc()) *s++ = ch;
        *s = 0;
    }
    inline void read(char&amp; c) {
        for (c = gc(); blank(c); c = gc())
            ;
    }
    template &lt;typename Type, typename... Args&gt;
    inline void read(Type&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char* t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;typename... Args&gt;
    inline void read(char&amp; t, Args&amp;... args) {
        read(t), read(args...);
    }
    template &lt;class Type&gt;
    inline void write(char lastChar, Type x) {
        if (x &lt; 0)
            *oS++ = &#39;-&#39;, x = -x;
        if (x == 0)
            *oS++ = &#39;0&#39;;
        while (x) fu[++fr] = x % 10 + &#39;0&#39;, x /= 10;
        while (fr) *oS++ = fu[fr--];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x[]) {
        for (register int i = 0; x[i]; ++i) *oS++ = x[i];
        *oS++ = lastChar;
        ioout();
    }
    inline void write(char lastChar, char x) {
        *oS++ = x;
        *oS++ = lastChar;
        ioout();
    }
    template &lt;typename Type, typename... Args&gt;
    inline void write(char midChar, Type t, Args... args) {
        write(midChar, t), write(midChar, args...);
    }
}  // namespace Fast_IO

using Fast_IO::read;
using Fast_IO::write;

const int SIZE = 5e5 + 5;
const int INF = 1e7;
int n, m, tot, rt[SIZE];
struct TreeNode {
    int l, r;
    int sum;
} data[SIZE &lt;&lt; 5];
struct TwoNode {
    int x, y;
} ints[SIZE];
struct BinarySeach {
    int upper_bound(int x) {
        int l = 1, r = n + 1;
        while (l &lt; r - 1) if (ints[mid].x &gt; x) r = mid; else l = mid;
        return l;
    }

    int lower_bound(int x) {
        int l = 0, r = n;
        while (l &lt; r - 1) if (ints[mid].x &gt;= x) r = mid; else l = mid;
        return r;
    }
} BS;

bool cmp(const TwoNode&amp; x, const TwoNode&amp; y) {
    return x.x &lt; y.x;
}

void update(int &amp;rt, int l, int r, int x) {
    data[++tot] = data[rt];
    ++data[rt = tot].sum;
    if (l ^ r) if (mid &gt;= x) update(ls, l, mid, x); else update(rs, mid + 1, r, x); else return ;
}

int queryf(int rt, int l, int r, int x, int y) {
    if (l &gt; y || r &lt; x || !rt) return 0;
    else if (l &gt;= x &amp;&amp; r &lt;= y) return data[rt].sum;
    else return queryf(ls, l, mid, x, y) + queryf(rs, mid + 1, r, x, y);
}

signed main() {
    read(n, m);
    for (int i = 1; i &lt;= n; ++i) read(ints[i].x, ints[i].y);
    sort(ints + 1, ints + 1 + n, cmp);
    for (int i = 1; i &lt;= n; ++i) update(rt[i] = rt[i - 1], 0, INF, ints[i].y);
    for (int i = 1, a, b, c, d; i &lt;= m; ++i) {
        read(a, b, c, d);
        write(io_l, queryf(rt[BS.upper_bound(c)], 0, INF, b, d) - queryf(rt[BS.lower_bound(a) - 1], 0, INF, b, d));
    }
    return 0;
}
</code></pre>
<h1 id="29-P5220"><a href="#29-P5220" class="headerlink" title="29.P5220 ??????????"></a>29.P5220 ??????????</h1><p>$\text{TYM}$ ?????????? $n$ ????????????? $1,\dots,n$???? $n - 1$ ???????????????????????????????????????????????<br>?????????????????????????????? $a_i$??</p>
<p>$\text{TYM}$ ??????? $m_0$ ??????????????????????????? $s,t$?????????????????<br>???????????????? $s$ ???????????????????????????????????? $s,t$ ?????????????? $t$??<br>????????????????????????????????????? $a_i$ ????????????????????<br>???????????????????????????????????????????????????????????????????????????????????????????????????????????????</p>
<p>???????????????????$s$ ?? $t$ ????????????????????????????? $20924$ ?????????</p>
<p>??????????????????????????????????????????????????????????????? $a_i$ ???????</p>
<p>???????????????????? $a_i$ ????????? $m$??</p>
<hr>
<h3 id="WGY-LCT"><a href="#WGY-LCT" class="headerlink" title="WGY??LCT"></a>WGY??LCT</h3><p>?????????????????????????????????????????????????????</p>
<p>????????????????????????????????????????????????????????????????????????LCT??</p>
<p>????????????????????,?????????????????????????</p>
<p>?????????????????LCT??????makeroot??access??</p>
<p>??????????????????????LCT????????makeroot??access??????????????</p>
<p>??????????????LCT?????????????????????????????????</p>
<p>??????????????<a href="https://paste.ubuntu.com/p/tsQ43Pvvg6/" target="_blank" rel="noopener">Link</a></p>
<p>??????????????????<a href="https://www.luogu.com.cn/paste/gtishzfw" target="_blank" rel="noopener">Link</a></p>
<pre><code class="lang-cpp">const int SIZE = 1e5 + 5;
const int M_SIZE = 2e5 + 5;
const int MOD = 20924;
int head[M_SIZE], nxt[M_SIZE];
int to[M_SIZE], ints[SIZE];
int waste[SIZE], n, m, top, tot;
struct SPLAY {
    int fa;
    int ch[2];
    int prod;
    int preprod;
    int sufprod;
    int lztg;
} data[SIZE];

void AddEdge(int x, int y) {
    to[++tot] = y;
    nxt[tot] = head[x];
    head[x] = tot;
}

bool IsRoot(int x) {
    return ((data[data[x].fa].ch[1] ^ x) &amp;&amp; (data[data[x].fa].ch[0] ^ x));
}

bool WhichSon(int x) {
    return (data[data[x].fa].ch[1] == x);
}

void UpdateMessages(int x) {
    data[x].prod = data[data[x].ch[0]].prod * data[data[x].ch[1]].prod % MOD * ints[x] % MOD;
    data[x].preprod = (data[data[x].ch[0]].preprod + data[data[x].ch[0]].prod * ints[x] + data[data[x].ch[0]].prod * ints[x] % MOD * data[data[x].ch[1]].preprod) % MOD;
    data[x].sufprod = (data[data[x].ch[1]].sufprod + data[data[x].ch[1]].prod * ints[x] + data[data[x].ch[1]].prod * ints[x] % MOD * data[data[x].ch[0]].sufprod) % MOD;
}

void UpdateSons(int x) {
    if (data[x].lztg) {
        swap(data[data[x].ch[0]].ch[0], data[data[x].ch[0]].ch[1]);
        swap(data[data[x].ch[1]].ch[0], data[data[x].ch[1]].ch[1]);
        swap(data[data[x].ch[0]].preprod, data[data[x].ch[0]].sufprod);
        swap(data[data[x].ch[1]].preprod, data[data[x].ch[1]].sufprod);
        data[data[x].ch[0]].lztg ^= 1;
        data[data[x].ch[1]].lztg ^= 1;
        data[x].lztg = 0;
    }
}

void RotateNode(int x) {
    int y = data[x].fa;
    int z = data[y].fa;
    int k = WhichSon(x);
    if (!IsRoot(y)) data[z].ch[WhichSon(y)] = x;
    data[y].fa = x;
    data[data[y].fa].fa = z;
    if (data[x].ch[k ^ 1]) data[data[x].ch[k ^ 1]].fa = y;
    data[y].ch[k] = data[x].ch[k ^ 1];
    data[x].ch[k ^ 1] = y;
    UpdateMessages(y);
}

void SplayToRoot(int x) {
    int y = waste[top = 1] = x;
    while (!IsRoot(y)) waste[++top] = y = data[y].fa;
    while (top) UpdateSons(waste[top--]);
    for (; !IsRoot(x); RotateNode(x))
        if (!IsRoot((y = data[x].fa)))
            RotateNode((data[data[y].fa].ch[1] ^ y ^ data[y].ch[1] ^ x) ? x : y);
    UpdateMessages(x);
}

void AccessEdge(int x) {
    for (int y = 0; x; x = data[y = x].fa) {
        SplayToRoot(x);
        data[x].ch[1] = y;
        UpdateMessages(x);
    }
}

void MakeRoot(int x) {
    AccessEdge(x);
    SplayToRoot(x);
    swap(data[x].ch[0], data[x].ch[1]);
    swap(data[x].preprod, data[x].sufprod);
    data[x].lztg ^= 1;
    UpdateMessages(x);
}

void SplitTree(int x, int y) {
    MakeRoot(x);
    AccessEdge(y);
    SplayToRoot(y);
}

void Prepare(int x) {
    data[x].prod = ints[x];
    data[x].preprod = ints[x];
    data[x].sufprod = ints[x];
    for (int i = head[x]; i; i = nxt[i])
        if (to[i] ^ data[x].fa)
            data[to[i]].fa = x, Prepare(to[i]);
}

int GetAnswers(int x, int y) {
    SplitTree(x, y);
    UpdateSons(y);
    return data[y].sufprod;
}

void Behavior(int x, int y) {
    SplitTree(x, x);
    ints[x] += y;
    ints[x] %= MOD;
    data[x].prod = ints[x];
    data[x].preprod = ints[x];
    data[x].sufprod = ints[x];
}

signed main() {
    read(n, m);
    for (int i = 1; i &lt;= n; ++i) read(ints[i]);
    for (int i = 1, x, y; i &lt; n; ++i) read(x, y), AddEdge(x, y), AddEdge(y, x);
    (*data).prod = 1;
    Prepare(1);
    for (int i = 0, x, y; i &lt; m; ++i) {
        char opt[5];
        read(opt);
        read(x, y);
        if (*opt ^ &#39;C&#39;) write(io_l, GetAnswers(x, y));
        else Behavior(x, y);
    }
    return 0;
}
</code></pre>
<h3 id="LYC-TCS"><a href="#LYC-TCS" class="headerlink" title="LYC:TCS"></a>LYC:TCS</h3>
          
            <hr>
            <center><img class="lazyload" onerror="imgError(this,3)" src="https://cdn.jsdelivr.net/gh/ctz45562/cdn@1.7.9/lazyload.gif" data-src="https://cdn.jsdelivr.net/gh/ctz45562/cdn@2.0.3/emojis/gif/23.gif"></center>
            <p style="font-size:32px;text-align:center;margin-top:-2px">施工中...</p>
                        
        </div>
        <!-- .entry-content -->
        <!-- <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/BoringHacker/cdn/img/custom/donate/AliPayQR.jpg"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/BoringHacker/cdn/img/custom/donate/WeChanQR.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer>. -->
        <!-- entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2020/02/08/DS100P-31-40-P/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/posts/post-34.png" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/posts/post-34.png">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                ?????100?? 31~40??</h3>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2020/02/08/DS100P-11-20-P/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/posts/post-32.png" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/posts/post-32.png">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                ?????100?? 11~20??</h3>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "8Hho6gvnedMT9NMEhnEx3UOg-gzGzoHsz",
        appKey: "gU70zYoblzxCmc6iL697pp69",
        path: window.location.pathname,
        placeholder: "Come And Get Your Love~"
      })
  }
</script>

      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <a href="/" class="profile gravatar"><img src="https://cdn.jsdelivr.net/gh/boringhacker/cdn/images/icons/avatar.png" itemprop="image" alt="BoringHacker" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="/" itemprop="url" rel="author">BoringHacker</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i>??????DS??OIER???????????</p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>

<script>
  var spoiler=document.getElementsByClassName('spoiler');
  for(var i=0;i<spoiler.length;++i)
  spoiler[i].onclick=function(){this.classList.toggle("revealed");};
  </script>  


  <script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.6/latest.js?config=TeX-MML-AM_CHTML"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
  </script>

    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 BoringHacker<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2018</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>

<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<!-- <script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script> -->
<script src="https://cdn.jsdelivr.net/gh/ctz45562/cdn@2.0.2/js/volantis.min.js"></script>
<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <!-- <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/BoringHacker/cdn/images/icons/avatar.png">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">BoringHacker'sBlog</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/honjun" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="http://weibo.com/mashirozx?is_all=1" class="fa fa-weibo" target="_blank" style="color: #dd4b39; margin-left:20px"></a>
      
        <a href="https://wpa.qq.com/msgrd?v=3&uin=954655431&site=qq&menu=yes" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            Home
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            Archives
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/bangumi/">
                  <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                  Animes
                </a>
              </li>
            
              <li>
                <a href="/Tools/">
                  <i class="fa fa-cogs" aria-hidden="true"></i>
                  Tools
                </a>
              </li>
            
              <li>
                <a href="/categories/Note/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  Notes
                </a>
              </li>
            
              <li>
                <a href="/categories/Solution">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  Solution
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/tags/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-tags" aria-hidden="true"></i>
            Tags
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            Comments
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            Links
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/game/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-gamepad" aria-hidden="true"></i>
            Game
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            About
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  Me
                </a>
              </li>
            
              <li>
                <a href="/lab/">
                  <i class="fa fa-bath" aria-hidden="true"></i>
                  Blog
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/atom.xml">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
            RSS
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    id="2660651585"

    server="netease"

    type="playlist"

    fixed="true"

    autoplay="false"

    loop="all"

    order="random"

    preload="auto"

    volume="0.7"

    mutex="true"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script> -->
</body>
</html>